
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../repo_structure/">
      
      
        <link rel="next" href="../features_limitations/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.20">
    
    
      
        <title>API Reference - PyNNLF Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.e53b48f4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="PyNNLF Documentation" class="md-header__button md-logo" aria-label="PyNNLF Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyNNLF Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="PyNNLF Documentation" class="md-nav__button md-logo" aria-label="PyNNLF Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    PyNNLF Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../getting_started/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../tool_testing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Tool Testing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Detailed Guide
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Detailed Guide
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../datasets_models/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Datasets & Models
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../run_experiment/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to run an experiment
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../modify_hyper/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to modify model hyperparameter
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_model/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to add a model
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../add_dataset/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    How to add a dataset
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../repo_structure/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Repo structure
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#folder-config" class="md-nav__link">
    <span class="md-ellipsis">
      Folder Config/
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.constant" class="md-nav__link">
    <span class="md-ellipsis">
      constant
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions" class="md-nav__link">
    <span class="md-ellipsis">
      general_functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.add_lag_features" class="md-nav__link">
    <span class="md-ellipsis">
      add_lag_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_MAE" class="md-nav__link">
    <span class="md-ellipsis">
      compute_MAE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_MAPE" class="md-nav__link">
    <span class="md-ellipsis">
      compute_MAPE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_MASE" class="md-nav__link">
    <span class="md-ellipsis">
      compute_MASE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_MBE" class="md-nav__link">
    <span class="md-ellipsis">
      compute_MBE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_R2" class="md-nav__link">
    <span class="md-ellipsis">
      compute_R2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_RMSE" class="md-nav__link">
    <span class="md-ellipsis">
      compute_RMSE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_exp_no" class="md-nav__link">
    <span class="md-ellipsis">
      compute_exp_no
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_folder_name" class="md-nav__link">
    <span class="md-ellipsis">
      compute_folder_name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_fskill" class="md-nav__link">
    <span class="md-ellipsis">
      compute_fskill
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.export_result" class="md-nav__link">
    <span class="md-ellipsis">
      export_result
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.histogram_residual" class="md-nav__link">
    <span class="md-ellipsis">
      histogram_residual
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.input_and_process" class="md-nav__link">
    <span class="md-ellipsis">
      input_and_process
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.prepare_directory" class="md-nav__link">
    <span class="md-ellipsis">
      prepare_directory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.produce_forecast" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.remove_jump_df" class="md-nav__link">
    <span class="md-ellipsis">
      remove_jump_df
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.run_experiment" class="md-nav__link">
    <span class="md-ellipsis">
      run_experiment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.run_model" class="md-nav__link">
    <span class="md-ellipsis">
      run_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.save_model" class="md-nav__link">
    <span class="md-ellipsis">
      save_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.scatterplot_forecast" class="md-nav__link">
    <span class="md-ellipsis">
      scatterplot_forecast
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.separate_holdout" class="md-nav__link">
    <span class="md-ellipsis">
      separate_holdout
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.split_time_series" class="md-nav__link">
    <span class="md-ellipsis">
      split_time_series
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.split_xy" class="md-nav__link">
    <span class="md-ellipsis">
      split_xy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.timeplot_forecast" class="md-nav__link">
    <span class="md-ellipsis">
      timeplot_forecast
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.timeplot_residual" class="md-nav__link">
    <span class="md-ellipsis">
      timeplot_residual
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.train_model" class="md-nav__link">
    <span class="md-ellipsis">
      train_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.model_hyperparameters" class="md-nav__link">
    <span class="md-ellipsis">
      model_hyperparameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#folder-model" class="md-nav__link">
    <span class="md-ellipsis">
      Folder Model/
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m1_naive" class="md-nav__link">
    <span class="md-ellipsis">
      m1_naive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m1_naive.produce_forecast_m1_naive" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m1_naive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m1_naive.train_model_m1_naive" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m1_naive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m2_snaive" class="md-nav__link">
    <span class="md-ellipsis">
      m2_snaive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m2_snaive.produce_forecast_m2_snaive" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m2_snaive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m2_snaive.train_model_m2_snaive" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m2_snaive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m3_ets" class="md-nav__link">
    <span class="md-ellipsis">
      m3_ets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m3_ets.produce_forecast_m3_ets" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m3_ets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m3_ets.train_model_m3_ets" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m3_ets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m4_arima" class="md-nav__link">
    <span class="md-ellipsis">
      m4_arima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m4_arima.produce_forecast_m4_arima" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m4_arima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m4_arima.train_model_m4_arima" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m4_arima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m5_sarima" class="md-nav__link">
    <span class="md-ellipsis">
      m5_sarima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m5_sarima.produce_forecast_m5_sarima" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m5_sarima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m5_sarima.train_model_m5_sarima" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m5_sarima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m6_lr" class="md-nav__link">
    <span class="md-ellipsis">
      m6_lr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m6_lr.produce_forecast_m6_lr" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m6_lr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m6_lr.train_model_m6_lr" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m6_lr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m7_ann" class="md-nav__link">
    <span class="md-ellipsis">
      m7_ann
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m7_ann.produce_forecast_m7_ann" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m7_ann
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m7_ann.train_model_m7_ann" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m7_ann
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m8_dnn" class="md-nav__link">
    <span class="md-ellipsis">
      m8_dnn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m8_dnn.produce_forecast_m8_dnn" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m8_dnn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m8_dnn.train_model_m8_dnn" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m8_dnn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m9_rt" class="md-nav__link">
    <span class="md-ellipsis">
      m9_rt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m9_rt.produce_forecast_m9_rt" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m9_rt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m9_rt.train_model_m9_rt" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m9_rt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m10_rf" class="md-nav__link">
    <span class="md-ellipsis">
      m10_rf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m10_rf.produce_forecast_m10_rf" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m10_rf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m10_rf.train_model_m10_rf" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m10_rf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m11_svr" class="md-nav__link">
    <span class="md-ellipsis">
      m11_svr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m11_svr.produce_forecast_m11_svr" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m11_svr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m11_svr.train_model_m11_svr" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m11_svr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m12_rnn" class="md-nav__link">
    <span class="md-ellipsis">
      m12_rnn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m12_rnn.produce_forecast_m12_rnn" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m12_rnn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m12_rnn.separate_lag_and_exogenous_features" class="md-nav__link">
    <span class="md-ellipsis">
      separate_lag_and_exogenous_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m12_rnn.train_model_m12_rnn" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m12_rnn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m13_lstm" class="md-nav__link">
    <span class="md-ellipsis">
      m13_lstm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m13_lstm.produce_forecast_m13_lstm" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m13_lstm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m13_lstm.separate_lag_and_exogenous_features" class="md-nav__link">
    <span class="md-ellipsis">
      separate_lag_and_exogenous_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m13_lstm.train_model_m13_lstm" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m13_lstm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m14_gru" class="md-nav__link">
    <span class="md-ellipsis">
      m14_gru
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m14_gru.produce_forecast_m14_gru" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m14_gru
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m14_gru.train_model_m14_gru" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m14_gru
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m15_transformer" class="md-nav__link">
    <span class="md-ellipsis">
      m15_transformer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m15_transformer.produce_forecast_m15_transformer" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m15_transformer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m15_transformer.train_model_m15_transformer" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m15_transformer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m16_prophet" class="md-nav__link">
    <span class="md-ellipsis">
      m16_prophet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m16_prophet.produce_forecast_m16_prophet" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m16_prophet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m16_prophet.train_model_m16_prophet" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m16_prophet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m17_xgb" class="md-nav__link">
    <span class="md-ellipsis">
      m17_xgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m17_xgb.produce_forecast_m17_xgb" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m17_xgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m17_xgb.train_model_m17_xgb" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m17_xgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m18_nbeats" class="md-nav__link">
    <span class="md-ellipsis">
      m18_nbeats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m18_nbeats.produce_forecast_m18_nbeats" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m18_nbeats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m18_nbeats.train_model_m18_nbeats" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m18_nbeats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.result_aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      result_aggregation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.run_experiment" class="md-nav__link">
    <span class="md-ellipsis">
      run_experiment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.run_experiment_batch" class="md-nav__link">
    <span class="md-ellipsis">
      run_experiment_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.run_tests" class="md-nav__link">
    <span class="md-ellipsis">
      run_tests
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../features_limitations/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Features & Limitations
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ack_license/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Acknowledgement & License
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../support_contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Support & Contributing
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributors/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributors
    
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#folder-config" class="md-nav__link">
    <span class="md-ellipsis">
      Folder Config/
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.config" class="md-nav__link">
    <span class="md-ellipsis">
      config
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.constant" class="md-nav__link">
    <span class="md-ellipsis">
      constant
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions" class="md-nav__link">
    <span class="md-ellipsis">
      general_functions
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.add_lag_features" class="md-nav__link">
    <span class="md-ellipsis">
      add_lag_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_MAE" class="md-nav__link">
    <span class="md-ellipsis">
      compute_MAE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_MAPE" class="md-nav__link">
    <span class="md-ellipsis">
      compute_MAPE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_MASE" class="md-nav__link">
    <span class="md-ellipsis">
      compute_MASE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_MBE" class="md-nav__link">
    <span class="md-ellipsis">
      compute_MBE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_R2" class="md-nav__link">
    <span class="md-ellipsis">
      compute_R2
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_RMSE" class="md-nav__link">
    <span class="md-ellipsis">
      compute_RMSE
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_exp_no" class="md-nav__link">
    <span class="md-ellipsis">
      compute_exp_no
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_folder_name" class="md-nav__link">
    <span class="md-ellipsis">
      compute_folder_name
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.compute_fskill" class="md-nav__link">
    <span class="md-ellipsis">
      compute_fskill
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.export_result" class="md-nav__link">
    <span class="md-ellipsis">
      export_result
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.histogram_residual" class="md-nav__link">
    <span class="md-ellipsis">
      histogram_residual
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.input_and_process" class="md-nav__link">
    <span class="md-ellipsis">
      input_and_process
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.prepare_directory" class="md-nav__link">
    <span class="md-ellipsis">
      prepare_directory
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.produce_forecast" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.remove_jump_df" class="md-nav__link">
    <span class="md-ellipsis">
      remove_jump_df
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.run_experiment" class="md-nav__link">
    <span class="md-ellipsis">
      run_experiment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.run_model" class="md-nav__link">
    <span class="md-ellipsis">
      run_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.save_model" class="md-nav__link">
    <span class="md-ellipsis">
      save_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.scatterplot_forecast" class="md-nav__link">
    <span class="md-ellipsis">
      scatterplot_forecast
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.separate_holdout" class="md-nav__link">
    <span class="md-ellipsis">
      separate_holdout
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.split_time_series" class="md-nav__link">
    <span class="md-ellipsis">
      split_time_series
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.split_xy" class="md-nav__link">
    <span class="md-ellipsis">
      split_xy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.timeplot_forecast" class="md-nav__link">
    <span class="md-ellipsis">
      timeplot_forecast
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.timeplot_residual" class="md-nav__link">
    <span class="md-ellipsis">
      timeplot_residual
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.general_functions.train_model" class="md-nav__link">
    <span class="md-ellipsis">
      train_model
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.config.model_hyperparameters" class="md-nav__link">
    <span class="md-ellipsis">
      model_hyperparameters
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#folder-model" class="md-nav__link">
    <span class="md-ellipsis">
      Folder Model/
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m1_naive" class="md-nav__link">
    <span class="md-ellipsis">
      m1_naive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m1_naive.produce_forecast_m1_naive" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m1_naive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m1_naive.train_model_m1_naive" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m1_naive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m2_snaive" class="md-nav__link">
    <span class="md-ellipsis">
      m2_snaive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m2_snaive.produce_forecast_m2_snaive" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m2_snaive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m2_snaive.train_model_m2_snaive" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m2_snaive
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m3_ets" class="md-nav__link">
    <span class="md-ellipsis">
      m3_ets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m3_ets.produce_forecast_m3_ets" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m3_ets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m3_ets.train_model_m3_ets" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m3_ets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m4_arima" class="md-nav__link">
    <span class="md-ellipsis">
      m4_arima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m4_arima.produce_forecast_m4_arima" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m4_arima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m4_arima.train_model_m4_arima" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m4_arima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m5_sarima" class="md-nav__link">
    <span class="md-ellipsis">
      m5_sarima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m5_sarima.produce_forecast_m5_sarima" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m5_sarima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m5_sarima.train_model_m5_sarima" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m5_sarima
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m6_lr" class="md-nav__link">
    <span class="md-ellipsis">
      m6_lr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m6_lr.produce_forecast_m6_lr" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m6_lr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m6_lr.train_model_m6_lr" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m6_lr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m7_ann" class="md-nav__link">
    <span class="md-ellipsis">
      m7_ann
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m7_ann.produce_forecast_m7_ann" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m7_ann
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m7_ann.train_model_m7_ann" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m7_ann
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m8_dnn" class="md-nav__link">
    <span class="md-ellipsis">
      m8_dnn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m8_dnn.produce_forecast_m8_dnn" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m8_dnn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m8_dnn.train_model_m8_dnn" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m8_dnn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m9_rt" class="md-nav__link">
    <span class="md-ellipsis">
      m9_rt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m9_rt.produce_forecast_m9_rt" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m9_rt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m9_rt.train_model_m9_rt" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m9_rt
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m10_rf" class="md-nav__link">
    <span class="md-ellipsis">
      m10_rf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m10_rf.produce_forecast_m10_rf" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m10_rf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m10_rf.train_model_m10_rf" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m10_rf
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m11_svr" class="md-nav__link">
    <span class="md-ellipsis">
      m11_svr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m11_svr.produce_forecast_m11_svr" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m11_svr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m11_svr.train_model_m11_svr" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m11_svr
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m12_rnn" class="md-nav__link">
    <span class="md-ellipsis">
      m12_rnn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m12_rnn.produce_forecast_m12_rnn" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m12_rnn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m12_rnn.separate_lag_and_exogenous_features" class="md-nav__link">
    <span class="md-ellipsis">
      separate_lag_and_exogenous_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m12_rnn.train_model_m12_rnn" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m12_rnn
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m13_lstm" class="md-nav__link">
    <span class="md-ellipsis">
      m13_lstm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m13_lstm.produce_forecast_m13_lstm" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m13_lstm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m13_lstm.separate_lag_and_exogenous_features" class="md-nav__link">
    <span class="md-ellipsis">
      separate_lag_and_exogenous_features
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m13_lstm.train_model_m13_lstm" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m13_lstm
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m14_gru" class="md-nav__link">
    <span class="md-ellipsis">
      m14_gru
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m14_gru.produce_forecast_m14_gru" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m14_gru
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m14_gru.train_model_m14_gru" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m14_gru
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m15_transformer" class="md-nav__link">
    <span class="md-ellipsis">
      m15_transformer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m15_transformer.produce_forecast_m15_transformer" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m15_transformer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m15_transformer.train_model_m15_transformer" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m15_transformer
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m16_prophet" class="md-nav__link">
    <span class="md-ellipsis">
      m16_prophet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m16_prophet.produce_forecast_m16_prophet" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m16_prophet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m16_prophet.train_model_m16_prophet" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m16_prophet
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m17_xgb" class="md-nav__link">
    <span class="md-ellipsis">
      m17_xgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m17_xgb.produce_forecast_m17_xgb" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m17_xgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m17_xgb.train_model_m17_xgb" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m17_xgb
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m18_nbeats" class="md-nav__link">
    <span class="md-ellipsis">
      m18_nbeats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m18_nbeats.produce_forecast_m18_nbeats" class="md-nav__link">
    <span class="md-ellipsis">
      produce_forecast_m18_nbeats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.m18_nbeats.train_model_m18_nbeats" class="md-nav__link">
    <span class="md-ellipsis">
      train_model_m18_nbeats
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.result_aggregation" class="md-nav__link">
    <span class="md-ellipsis">
      result_aggregation
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.run_experiment" class="md-nav__link">
    <span class="md-ellipsis">
      run_experiment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.run_experiment_batch" class="md-nav__link">
    <span class="md-ellipsis">
      run_experiment_batch
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#docs.notebooks.model.run_tests" class="md-nav__link">
    <span class="md-ellipsis">
      run_tests
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="api-reference">API Reference<a class="headerlink" href="#api-reference" title="Permanent link">&para;</a></h1>
<h2 id="folder-config">Folder <code>Config/</code><a class="headerlink" href="#folder-config" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<a id="docs.notebooks.config.config"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.config.constant"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.config.general_functions"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.add_lag_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_lag_features</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">max_lag_day</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.add_lag_features" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Adds a lagged column to the dataframe based on the given horizon in minutes and max lag in days.</p>
<p>Args:
df (pd.DataFrame): The input dataframe with a datetime index and a column 'y'.
forecast_horizon (int): The horizon in minutes for the lag.
max_lag_day (int): the number of days until the longest lag</p>
<p>Returns:
pd.DataFrame: The dataframe with additional columns for the lags.</p>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">add_lag_features</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">max_lag_day</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds a lagged column to the dataframe based on the given horizon in minutes and max lag in days.</span>

<span class="sd">    Args:</span>
<span class="sd">    df (pd.DataFrame): The input dataframe with a datetime index and a column &#39;y&#39;.</span>
<span class="sd">    forecast_horizon (int): The horizon in minutes for the lag.</span>
<span class="sd">    max_lag_day (int): the number of days until the longest lag</span>

<span class="sd">    Returns:</span>
<span class="sd">    pd.DataFrame: The dataframe with additional columns for the lags.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert the horizon to a timedelta object</span>
    <span class="n">horizon_timedelta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="n">consecutive_timedelta</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="c1"># Calculate the number of new columns</span>
    <span class="n">n_new_cols</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">&lt;</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">DateOffset</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="n">max_lag_day</span><span class="p">)])</span>

    <span class="c1"># List to hold all the new lagged columns</span>
    <span class="n">new_cols</span> <span class="o">=</span> <span class="p">[]</span>

    <span class="c1"># Generate lagged columns based on the horizon and max lag</span>

    <span class="c1">#Generate lagged columns not only based on net load but also based on weather data if available</span>
    <span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="c1"># Generate lagged columns for the current column</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_new_cols</span><span class="p">):</span>
            <span class="n">shift_timedelta</span> <span class="o">=</span> <span class="n">horizon_timedelta</span> <span class="o">+</span> <span class="n">i</span> <span class="o">*</span> <span class="n">consecutive_timedelta</span>
            <span class="n">new_col_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">column</span><span class="si">}</span><span class="s1">_lag_</span><span class="si">{</span><span class="n">shift_timedelta</span><span class="si">}</span><span class="s1">m&#39;</span>
            <span class="n">new_cols</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">column</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="n">shift_timedelta</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">new_col_name</span><span class="p">))</span>


    <span class="c1"># Concatenate the new lagged columns with the original dataframe</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">]</span> <span class="o">+</span> <span class="n">new_cols</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.compute_MAE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_MAE</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.compute_MAE" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>As the name suggest.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>forecast</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the forecast result from the model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the observed value (actual value)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>error as the name suggest (float): as the name suggest</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_MAE</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;As the name suggest.</span>

<span class="sd">    Args:</span>
<span class="sd">        forecast (df): series of the forecast result from the model</span>
<span class="sd">        observation (df): series of the observed value (actual value)</span>

<span class="sd">    Returns:</span>
<span class="sd">        error as the name suggest (float): as the name suggest</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">((</span><span class="nb">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">observation</span><span class="p">))</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.compute_MAPE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_MAPE</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.compute_MAPE" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>As the name suggest. Be careful with MAPE though because its value can go to inf since the observed value can be 0. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>forecast</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the forecast result from the model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the observed value (actual value)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>error as the name suggest (float): as the name suggest</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_MAPE</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;As the name suggest. Be careful with MAPE though because its value can go to inf since the observed value can be 0. </span>

<span class="sd">    Args:</span>
<span class="sd">        forecast (df): series of the forecast result from the model</span>
<span class="sd">        observation (df): series of the observed value (actual value)</span>

<span class="sd">    Returns:</span>
<span class="sd">        error as the name suggest (float): as the name suggest</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">((</span><span class="nb">abs</span><span class="p">((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">observation</span><span class="p">)</span> <span class="o">/</span> <span class="n">observation</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.compute_MASE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_MASE</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="n">train_result</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.compute_MASE" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>As the name suggest. MASE is first introduced by Rob Hyndman, used to handle MAPE problem being infinity. 
Instead of using observed value as denominator,
MASE uses MAE of the naive forecast at the train set for denominator. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>forecast</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the forecast result from the model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the observed value (actual value)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>error as the name suggest (float): as the name suggest</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_MASE</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="n">train_result</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;As the name suggest. MASE is first introduced by Rob Hyndman, used to handle MAPE problem being infinity. </span>
<span class="sd">    Instead of using observed value as denominator,</span>
<span class="sd">    MASE uses MAE of the naive forecast at the train set for denominator. </span>

<span class="sd">    Args:</span>
<span class="sd">        forecast (df): series of the forecast result from the model</span>
<span class="sd">        observation (df): series of the observed value (actual value)</span>

<span class="sd">    Returns:</span>
<span class="sd">        error as the name suggest (float): as the name suggest</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">errors</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">observation</span><span class="p">)</span>
    <span class="n">MAE_naive</span> <span class="o">=</span> <span class="n">compute_MAE</span><span class="p">(</span><span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;naive&#39;</span><span class="p">],</span> <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">])</span>

    <span class="n">MASE</span> <span class="o">=</span> <span class="n">errors</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">/</span> <span class="n">MAE_naive</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">MASE</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.compute_MBE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_MBE</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.compute_MBE" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>As the name suggest.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>forecast</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the forecast result from the model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the observed value (actual value)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>error as the name suggest (float): as the name suggest</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_MBE</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;As the name suggest.</span>

<span class="sd">    Args:</span>
<span class="sd">        forecast (df): series of the forecast result from the model</span>
<span class="sd">        observation (df): series of the observed value (actual value)</span>

<span class="sd">    Returns:</span>
<span class="sd">        error as the name suggest (float): as the name suggest</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">observation</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">observation</span><span class="p">),</span> <span class="mi">5</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.compute_R2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_R2</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.compute_R2" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>As the name suggest. Be careful with R2 though because it is not a forecast evaluation. 
It is just used to show linearity on the scatter plot of forecast and observed value. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>forecast</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the forecast result from the model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the observed value (actual value)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>error as the name suggest (float): as the name suggest</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_R2</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;As the name suggest. Be careful with R2 though because it is not a forecast evaluation. </span>
<span class="sd">    It is just used to show linearity on the scatter plot of forecast and observed value. </span>

<span class="sd">    Args:</span>
<span class="sd">        forecast (df): series of the forecast result from the model</span>
<span class="sd">        observation (df): series of the observed value (actual value)</span>

<span class="sd">    Returns:</span>
<span class="sd">        error as the name suggest (float): as the name suggest</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">forecast</span><span class="o">.</span><span class="n">corr</span><span class="p">(</span><span class="n">observation</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.compute_RMSE" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_RMSE</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.compute_RMSE" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>As the name suggest.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>forecast</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the forecast result from the model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the observed value (actual value)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>error as the name suggest (float): as the name suggest</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_RMSE</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;As the name suggest.</span>

<span class="sd">    Args:</span>
<span class="sd">        forecast (df): series of the forecast result from the model</span>
<span class="sd">        observation (df): series of the observed value (actual value)</span>

<span class="sd">    Returns:</span>
<span class="sd">        error as the name suggest (float): as the name suggest</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(((</span><span class="n">forecast</span> <span class="o">-</span> <span class="n">observation</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()),</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.compute_exp_no" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_exp_no</span><span class="p">(</span><span class="n">path_result</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.compute_exp_no" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Compute experiment number for folder &amp; file naming based on the number of existing experiments that have been done.
For example, if on the folder there are already 5 experiment folders, then the new experiment no. is E00006.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_result</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>relative path of experiment folder, stored in config</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>int</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>exp no </p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>exp no in str</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_exp_no</span><span class="p">(</span><span class="n">path_result</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute experiment number for folder &amp; file naming based on the number of existing experiments that have been done.</span>
<span class="sd">    For example, if on the folder there are already 5 experiment folders, then the new experiment no. is E00006.</span>

<span class="sd">    Args:</span>
<span class="sd">        path_result (str): relative path of experiment folder, stored in config</span>

<span class="sd">    Returns:</span>
<span class="sd">        int: exp no </span>
<span class="sd">        str: exp no in str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">subfolders</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">path_result</span><span class="p">)</span>
    <span class="n">number_of_folders</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">subfolders</span><span class="p">)</span>
    <span class="n">experiment_no</span> <span class="o">=</span> <span class="n">number_of_folders</span> <span class="o">-</span> <span class="mi">1</span> <span class="c1"># there is one archive folder</span>
    <span class="n">experiment_no_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;E</span><span class="si">{</span><span class="nb">str</span><span class="p">(</span><span class="n">experiment_no</span><span class="p">)</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">return</span> <span class="n">experiment_no</span><span class="p">,</span> <span class="n">experiment_no_str</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.compute_folder_name" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_folder_name</span><span class="p">(</span><span class="n">experiment_no_str</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter_no</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.compute_folder_name" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Folder name in the format of [exp number]<em>[exp date]</em>[dataset]<em>[forecast horizon]</em>[model]_[hyperparameter]</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>experiment_no_str</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>exp number</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast horizon in minutes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>for example, m1_naive</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter_no</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>for example, hp1</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>str</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>folder name</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_folder_name</span><span class="p">(</span><span class="n">experiment_no_str</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter_no</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Folder name in the format of [exp number]_[exp date]_[dataset]_[forecast horizon]_[model]_[hyperparameter]</span>

<span class="sd">    Args:</span>
<span class="sd">        experiment_no_str (str): exp number</span>
<span class="sd">        forecast_horizon (int): forecast horizon in minutes</span>
<span class="sd">        model_name (str): for example, m1_naive</span>
<span class="sd">        hyperparameter_no (str): for example, hp1</span>

<span class="sd">    Returns:</span>
<span class="sd">        str: folder name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">folder_name</span> <span class="o">=</span> \
        <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span>\
        <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%y%m</span><span class="si">%d</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span>\
        <span class="n">dataset</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span>\
        <span class="s1">&#39;fh&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">forecast_horizon</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span>\
        <span class="n">model_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span>\
        <span class="n">hyperparameter_no</span>
    <span class="k">return</span> <span class="n">folder_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.compute_fskill" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_fskill</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="n">naive</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.compute_fskill" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>As the name suggest. Forecast Skill is a relative measure seeing the improvement 
of the model performance over naive model. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>forecast</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the forecast result from the model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>observation</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>series of the observed value (actual value)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>error as the name suggest (float): as the name suggest</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_fskill</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="n">naive</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;As the name suggest. Forecast Skill is a relative measure seeing the improvement </span>
<span class="sd">    of the model performance over naive model. </span>

<span class="sd">    Args:</span>
<span class="sd">        forecast (df): series of the forecast result from the model</span>
<span class="sd">        observation (df): series of the observed value (actual value)</span>

<span class="sd">    Returns:</span>
<span class="sd">        error as the name suggest (float): as the name suggest</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="nb">round</span><span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">compute_RMSE</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">)</span> <span class="o">/</span> <span class="n">compute_RMSE</span><span class="p">(</span><span class="n">naive</span><span class="p">,</span> <span class="n">observation</span><span class="p">))</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.export_result" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">export_result</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">df_a1_result</span><span class="p">,</span> <span class="n">cross_val_result_df</span><span class="p">,</span> <span class="n">hyperparameter</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.export_result" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Export experiment summary:
1. experiment result
2. hyperparameter
3. cross validation detailed result</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary of filepaths for exporting result</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">export_result</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">df_a1_result</span><span class="p">,</span> <span class="n">cross_val_result_df</span><span class="p">,</span> <span class="n">hyperparameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Export experiment summary:</span>
<span class="sd">    1. experiment result</span>
<span class="sd">    2. hyperparameter</span>
<span class="sd">    3. cross validation detailed result</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath (dict): dictionary of filepaths for exporting result</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a df of hyperparameter being used</span>
    <span class="n">df_a2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">)</span>

    <span class="c1"># EXPORT IT</span>
    <span class="n">df_a1_result</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;a1&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df_a2</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;a2&#39;</span><span class="p">])</span>
    <span class="n">cross_val_result_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;a3&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.histogram_residual" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">histogram_residual</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">pathname</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.histogram_residual" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Produce histogiram of residual value and save it on the designated folder</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>residual</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast - observation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pathname</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filepath to save the figure</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">histogram_residual</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">pathname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produce histogiram of residual value and save it on the designated folder</span>

<span class="sd">    Args:</span>
<span class="sd">        residual (df): forecast - observation</span>
<span class="sd">        pathname (str): filepath to save the figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create the figure with specified size</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

    <span class="c1"># Set background color</span>
    <span class="c1"># plt.gcf().patch.set_facecolor(platinum)</span>

    <span class="c1"># Compute the range</span>
    <span class="n">dataset_range</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">bin_min</span> <span class="o">=</span> <span class="o">-</span><span class="n">dataset_range</span><span class="o">/</span><span class="mi">7</span>
    <span class="n">bin_max</span> <span class="o">=</span> <span class="n">dataset_range</span><span class="o">/</span><span class="mi">7</span>

    <span class="c1"># Plot the actual and forecast data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="nb">range</span><span class="o">=</span><span class="p">(</span><span class="n">bin_min</span><span class="p">,</span> <span class="n">bin_max</span><span class="p">),</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>


    <span class="c1"># Set the font to Arial</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Arial&#39;</span>

    <span class="c1"># Remove grid lines</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Set tick marks for x and y axis</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Add borders to the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>

    <span class="c1"># Remove the tick markers (the small lines)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Remove x-axis tick markers</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Remove y-axis tick markers</span>

    <span class="c1"># Set axis titles</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Forecast Residual (kW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Count&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">)</span>

    <span class="c1"># Remove title</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>


    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.input_and_process" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">input_and_process</span><span class="p">(</span><span class="n">path_data_cleaned</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">max_lag_day</span><span class="p">,</span> <span class="n">n_block</span><span class="p">,</span> <span class="n">hyperparameter</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.input_and_process" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>read dataset, add calendar features, add lag features (which depends on the forecast horizon).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_data_cleaned</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path to the dataset chosen</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast horizon in minutes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_lag_day</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>how much lag data will be used, written in days. For example, 7 means lag data until d-7 is used. </p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_block</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of blocks to divide the original df. This includes the block for hold_out_df, so if k=10, this n_block = k+1 = 11</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameters for the model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>block_length</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of weeks per block</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>holdout_df</code></td>            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>unused df, can be used later for unbiased estimate of final model performance</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>df</code></td>            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>df that will be used for training and validation (test) set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">input_and_process</span><span class="p">(</span><span class="n">path_data_cleaned</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">max_lag_day</span><span class="p">,</span> <span class="n">n_block</span><span class="p">,</span> <span class="n">hyperparameter</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;read dataset, add calendar features, add lag features (which depends on the forecast horizon).</span>

<span class="sd">    Args:</span>
<span class="sd">        path_data_cleaned (str): path to the dataset chosen</span>
<span class="sd">        forecast_horizon (int): forecast horizon in minutes</span>
<span class="sd">        max_lag_day (int): how much lag data will be used, written in days. For example, 7 means lag data until d-7 is used. </span>
<span class="sd">        n_block (int): number of blocks to divide the original df. This includes the block for hold_out_df, so if k=10, this n_block = k+1 = 11</span>
<span class="sd">        hyperparameter (dict): hyperparameters for the model</span>

<span class="sd">    Returns:</span>
<span class="sd">        block_length (int): number of weeks per block</span>
<span class="sd">        holdout_df (df): unused df, can be used later for unbiased estimate of final model performance</span>
<span class="sd">        df (df): df that will be used for training and validation (test) set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># MAKE THIS AS FUNCTION</span>
    <span class="c1"># ADD CALENDAR DATA (holiday to add)</span>
    <span class="c1"># columns_to_use = [&#39;datetime&#39;, &#39;netload_kW&#39;]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path_data_cleaned</span> <span class="o">+</span> <span class="n">dataset</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;netload_kW&#39;</span><span class="p">:</span> <span class="s1">&#39;y&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># 1. Check if forecast horizon is &gt;= dataset frequency</span>
    <span class="c1"># for example, if dataset is daily, forecast horizon should be at least 1 day</span>
    <span class="c1"># compute dataset frequency in minutes based on the datetime index</span>
    <span class="n">dataset_freq</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="mi">60</span>
    <span class="k">if</span> <span class="n">forecast_horizon</span> <span class="o">&lt;</span> <span class="n">dataset_freq</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Forecast horizon should be &gt;= dataset frequency&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pass Test 1 - Forecast horizon is &gt;= dataset frequency&#39;</span><span class="p">)</span>

    <span class="c1"># 2. Check if hyperparameter choice is possible given the forecast horizon</span>
    <span class="c1"># for example, with forecast horizon of 2 days, we cannot use 1 day as the hyperparameter of seasonal naive forecast.</span>


    <span class="k">if</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m2_snaive&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;days&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">forecast_horizon</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Choice of seasonal naive hyperparameter needs to be &gt;= forecast horizon! Please change the hyperparameter.&#39;</span><span class="p">)</span>
    <span class="c1"># if model_name == &#39;m4_sarima&#39;:</span>
    <span class="c1">#     if int(hyperparameter[&#39;seasonal_period_days&#39;] * 24 * 60) &lt; forecast_horizon:</span>
    <span class="c1">#         raise ValueError(&#39;Choice of seasonal_period_days in SARIMA hyperparameter &gt;= forecast horizon! Please change the hyperparameter.&#39;)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Pass Test 2 - Hyperparameter choice is possible given the forecast horizon&#39;</span><span class="p">)</span>


<span class="c1"># ADD LAG FEATURES</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">add_lag_features</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">max_lag_day</span><span class="p">)</span>

<span class="c1"># ADD CALENDAR FEATURES    </span>
    <span class="c1"># 1. Numerical representation of the datetime (Excel-style)</span>
    <span class="n">numeric_datetime</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;1970-01-01&quot;</span><span class="p">))</span> <span class="o">/</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">days</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="c1"># 2. Year</span>
    <span class="n">year</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

    <span class="c1"># 3. One-hot encoding of month (is_jan, is_feb, ..., is_nov, excluding December)</span>
    <span class="n">month_dummies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">month</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Custom column names for months: is_jan, is_feb, ..., is_nov</span>
    <span class="n">month_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;is_jan&#39;</span><span class="p">,</span> <span class="s1">&#39;is_feb&#39;</span><span class="p">,</span> <span class="s1">&#39;is_mar&#39;</span><span class="p">,</span> <span class="s1">&#39;is_apr&#39;</span><span class="p">,</span> <span class="s1">&#39;is_may&#39;</span><span class="p">,</span> <span class="s1">&#39;is_jun&#39;</span><span class="p">,</span> 
                <span class="s1">&#39;is_jul&#39;</span><span class="p">,</span> <span class="s1">&#39;is_aug&#39;</span><span class="p">,</span> <span class="s1">&#39;is_sep&#39;</span><span class="p">,</span> <span class="s1">&#39;is_oct&#39;</span><span class="p">,</span> <span class="s1">&#39;is_nov&#39;</span><span class="p">,</span> <span class="s1">&#39;is_dec&#39;</span><span class="p">]</span>  

    <span class="c1"># Drop the last column (December) to avoid redundancy and rename the columns</span>
    <span class="n">month_dummies</span> <span class="o">=</span> <span class="n">month_dummies</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Exclude December column</span>
    <span class="n">month_dummies</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">month_names</span><span class="p">[:</span><span class="n">month_dummies</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>  <span class="c1"># Apply custom column names</span>
    <span class="n">month_dummies</span> <span class="o">=</span> <span class="n">month_dummies</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># Convert to 1 and 0</span>
    <span class="n">month_dummies</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>

    <span class="c1"># 4. One-hot encoding of hour (hour_0, hour_1, ..., hour_22, excluding hour_23)</span>
    <span class="n">hour_dummies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">hour</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;hour&#39;</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">hour_dummies</span> <span class="o">=</span> <span class="n">hour_dummies</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># Convert to 1 and 0</span>
    <span class="n">hour_dummies</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>

    <span class="c1"># 5. One-hot encoding of day of week (is_mon, is_tue, ..., is_sat, excluding Sunday)</span>
    <span class="c1"># Mapping day of week (0=Mon, 1=Tue, ..., 6=Sun)</span>
    <span class="n">dayofweek_dummies</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofweek</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;is&#39;</span><span class="p">,</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Custom mapping for days of the week: is_mon, is_tue, ..., is_sat</span>
    <span class="n">dayofweek_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;is_mon&#39;</span><span class="p">,</span> <span class="s1">&#39;is_tue&#39;</span><span class="p">,</span> <span class="s1">&#39;is_wed&#39;</span><span class="p">,</span> <span class="s1">&#39;is_thu&#39;</span><span class="p">,</span> <span class="s1">&#39;is_fri&#39;</span><span class="p">,</span> <span class="s1">&#39;is_sat&#39;</span><span class="p">]</span>  <span class="c1"># Custom day names</span>
    <span class="n">dayofweek_dummies</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">dayofweek_names</span><span class="p">[:</span><span class="n">dayofweek_dummies</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>  <span class="c1"># Apply custom column names</span>
    <span class="n">dayofweek_dummies</span> <span class="o">=</span> <span class="n">dayofweek_dummies</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>  <span class="c1"># Convert to 1 and 0</span>
    <span class="n">dayofweek_dummies</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>

    <span class="c1"># 6. Is weekday (1 if Monday to Friday, 0 if Saturday/Sunday)</span>
    <span class="n">is_weekday</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">dayofweek</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">),</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>


    <span class="c1"># Concatenate all new features into the original dataframe at once</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> 
                    <span class="n">numeric_datetime</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;numeric_datetime&#39;</span><span class="p">),</span> 
                    <span class="n">year</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">),</span>
                    <span class="n">month_dummies</span><span class="p">,</span> 
                    <span class="n">hour_dummies</span><span class="p">,</span> 
                    <span class="n">dayofweek_dummies</span><span class="p">,</span> 
                    <span class="n">is_weekday</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s1">&#39;is_weekday&#39;</span><span class="p">)],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">block_length</span><span class="p">,</span> <span class="n">holdout_df</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">separate_holdout</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_block</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">block_length</span><span class="p">,</span> <span class="n">holdout_df</span><span class="p">,</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.prepare_directory" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_directory</span><span class="p">(</span><span class="n">path_result</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter_no</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.prepare_directory" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Do two things,
1. Create folders inside the experiment result folder
2. Create some file names to be used when exporting result later</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_result</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>relative path to the experiment result folder</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast horizon in minutes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>eg m1_naive</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter_no</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>eg</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>hyperparameter</code></td>            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>pd df series of hyperparameter chosen</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>experiment_no_str (str) : experiment number</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filepath (dict) : dict of all filepaths that will be exported</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">prepare_directory</span><span class="p">(</span><span class="n">path_result</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter_no</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Do two things,</span>
<span class="sd">    1. Create folders inside the experiment result folder</span>
<span class="sd">    2. Create some file names to be used when exporting result later</span>


<span class="sd">    Args:</span>
<span class="sd">        path_result (str): relative path to the experiment result folder</span>
<span class="sd">        forecast_horizon (int): forecast horizon in minutes</span>
<span class="sd">        model_name (str): eg m1_naive</span>
<span class="sd">        hyperparameter_no (str): eg</span>

<span class="sd">    Returns:</span>
<span class="sd">        hyperparameter (df): pd df series of hyperparameter chosen</span>
<span class="sd">        experiment_no_str (str) : experiment number</span>
<span class="sd">        filepath (dict) : dict of all filepaths that will be exported</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">hyperparameter_table</span> <span class="o">=</span> <span class="nb">globals</span><span class="p">()[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s2">_hp_table&quot;</span><span class="p">]</span>
    <span class="n">hyperparameter</span> <span class="o">=</span> <span class="n">hyperparameter_table</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">hyperparameter_no</span><span class="p">]</span>

    <span class="n">experiment_no</span><span class="p">,</span> <span class="n">experiment_no_str</span> <span class="o">=</span> <span class="n">compute_exp_no</span><span class="p">(</span><span class="n">path_result</span><span class="p">)</span>
    <span class="n">folder_name</span> <span class="o">=</span> <span class="n">compute_folder_name</span><span class="p">(</span><span class="n">experiment_no_str</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter_no</span><span class="p">)</span>

    <span class="c1"># CREATE FOLDER</span>
    <span class="n">cv_folder_train</span> <span class="o">=</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv_train&#39;</span>
    <span class="n">cv_folder_test</span> <span class="o">=</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv_test&#39;</span>
    <span class="n">cv1_plot_folder</span> <span class="o">=</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv1_plots&#39;</span>
    <span class="n">folder_model</span> <span class="o">=</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_models&#39;</span>

    <span class="n">path_result2</span> <span class="o">=</span> <span class="n">path_result</span> <span class="o">+</span> <span class="n">folder_name</span> <span class="o">+</span><span class="s1">&#39;/&#39;</span>
    <span class="n">path_result_train</span> <span class="o">=</span> <span class="n">path_result2</span> <span class="o">+</span> <span class="n">cv_folder_train</span> <span class="o">+</span><span class="s1">&#39;/&#39;</span>
    <span class="n">path_result_test</span> <span class="o">=</span> <span class="n">path_result2</span> <span class="o">+</span> <span class="n">cv_folder_test</span> <span class="o">+</span><span class="s1">&#39;/&#39;</span>
    <span class="n">path_result_plot</span> <span class="o">=</span> <span class="n">path_result2</span> <span class="o">+</span> <span class="n">cv1_plot_folder</span> <span class="o">+</span><span class="s1">&#39;/&#39;</span>
    <span class="n">path_model</span> <span class="o">=</span> <span class="n">path_result2</span> <span class="o">+</span> <span class="n">folder_model</span> <span class="o">+</span><span class="s1">&#39;/&#39;</span>

    <span class="c1"># MAKE FOLDERS</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_result2</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_result_train</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_result_test</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_result_plot</span><span class="p">)</span>
    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">path_model</span><span class="p">)</span>

    <span class="c1"># MAKE FILE PATH</span>
    <span class="n">filepath</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;a1&#39;</span> <span class="p">:</span> <span class="n">path_result2</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_a1_experiment_result.csv&#39;</span><span class="p">,</span>
        <span class="s1">&#39;a2&#39;</span> <span class="p">:</span> <span class="n">path_result2</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_a2_hyperparameter.csv&#39;</span><span class="p">,</span>
        <span class="s1">&#39;a3&#39;</span> <span class="p">:</span> <span class="n">path_result2</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_a3_cross_validation_result.csv&#39;</span><span class="p">,</span>
        <span class="s1">&#39;b1&#39;</span> <span class="p">:</span> <span class="n">path_result_plot</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_b1_train_timeplot.png&#39;</span><span class="p">,</span> <span class="c1"># Time Plot of Forecast vs Observation</span>
        <span class="s1">&#39;b2&#39;</span> <span class="p">:</span> <span class="n">path_result_plot</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_b2_train_scatterplot.png&#39;</span><span class="p">,</span> <span class="c1"># Scatter Plot of Forecast vs Observation</span>
        <span class="s1">&#39;b3&#39;</span> <span class="p">:</span> <span class="n">path_result_plot</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_b3_train_residual_timeplot.png&#39;</span><span class="p">,</span> <span class="c1"># Time Plot of Residual</span>
        <span class="s1">&#39;b4&#39;</span> <span class="p">:</span> <span class="n">path_result_plot</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_b4_train_residual_histogram.png&#39;</span><span class="p">,</span> <span class="c1"># Histogram of Residual</span>
        <span class="s1">&#39;b5&#39;</span> <span class="p">:</span> <span class="n">path_result_plot</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_b5_train_learningcurve.png&#39;</span><span class="p">,</span> <span class="c1"># Learning Curve vs Epoch</span>
        <span class="s1">&#39;c1&#39;</span> <span class="p">:</span> <span class="n">path_result_plot</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_c1_test_timeplot.png&#39;</span><span class="p">,</span>  <span class="c1"># Time Plot of Forecast vs Observation</span>
        <span class="s1">&#39;c2&#39;</span> <span class="p">:</span> <span class="n">path_result_plot</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_c2_test_scatterplot.png&#39;</span><span class="p">,</span>  <span class="c1"># Scatter Plot of Forecast vs Observation</span>
        <span class="s1">&#39;c3&#39;</span> <span class="p">:</span> <span class="n">path_result_plot</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_c3_test_residual_timeplot.png&#39;</span><span class="p">,</span>  <span class="c1"># Time Plot of Residual</span>
        <span class="s1">&#39;c4&#39;</span> <span class="p">:</span> <span class="n">path_result_plot</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_c4_test_residual_histogram.png&#39;</span><span class="p">,</span>  <span class="c1"># Histogram of Residual</span>
        <span class="s1">&#39;c5&#39;</span> <span class="p">:</span> <span class="n">path_result_plot</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_c5_test_learningcurve.png&#39;</span><span class="p">,</span>  <span class="c1"># Learning Curve vs Epoch</span>

        <span class="c1"># B. FOLDER FOR CROSS VALIDATION TIME SERIES</span>
        <span class="s1">&#39;train_cv&#39;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="mi">1</span> <span class="p">:</span> <span class="n">path_result_train</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv1_train_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">2</span> <span class="p">:</span> <span class="n">path_result_train</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv2_train_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">3</span> <span class="p">:</span> <span class="n">path_result_train</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv3_train_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">4</span> <span class="p">:</span> <span class="n">path_result_train</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv4_train_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">5</span> <span class="p">:</span> <span class="n">path_result_train</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv5_train_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">6</span> <span class="p">:</span> <span class="n">path_result_train</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv6_train_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">7</span> <span class="p">:</span> <span class="n">path_result_train</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv7_train_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">8</span> <span class="p">:</span> <span class="n">path_result_train</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv8_train_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">9</span> <span class="p">:</span> <span class="n">path_result_train</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv9_train_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">10</span> <span class="p">:</span> <span class="n">path_result_train</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv10_train_result.csv&#39;</span>
        <span class="p">},</span>

        <span class="s1">&#39;test_cv&#39;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="mi">1</span> <span class="p">:</span> <span class="n">path_result_test</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv1_test_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">2</span> <span class="p">:</span> <span class="n">path_result_test</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv2_test_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">3</span> <span class="p">:</span> <span class="n">path_result_test</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv3_test_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">4</span> <span class="p">:</span> <span class="n">path_result_test</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv4_test_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">5</span> <span class="p">:</span> <span class="n">path_result_test</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv5_test_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">6</span> <span class="p">:</span> <span class="n">path_result_test</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv6_test_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">7</span> <span class="p">:</span> <span class="n">path_result_test</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv7_test_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">8</span> <span class="p">:</span> <span class="n">path_result_test</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv8_test_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">9</span> <span class="p">:</span> <span class="n">path_result_test</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv9_test_result.csv&#39;</span><span class="p">,</span>
            <span class="mi">10</span> <span class="p">:</span> <span class="n">path_result_test</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv10_test_result.csv&#39;</span>
        <span class="p">},</span>

        <span class="s1">&#39;model&#39;</span> <span class="p">:</span> <span class="p">{</span>
            <span class="mi">1</span> <span class="p">:</span> <span class="n">path_model</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv1_model.pkl&#39;</span><span class="p">,</span>
            <span class="mi">2</span> <span class="p">:</span> <span class="n">path_model</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv2_model.pkl&#39;</span><span class="p">,</span>
            <span class="mi">3</span> <span class="p">:</span> <span class="n">path_model</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv3_model.pkl&#39;</span><span class="p">,</span>
            <span class="mi">4</span> <span class="p">:</span> <span class="n">path_model</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv4_model.pkl&#39;</span><span class="p">,</span>
            <span class="mi">5</span> <span class="p">:</span> <span class="n">path_model</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv5_model.pkl&#39;</span><span class="p">,</span>
            <span class="mi">6</span> <span class="p">:</span> <span class="n">path_model</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv6_model.pkl&#39;</span><span class="p">,</span>
            <span class="mi">7</span> <span class="p">:</span> <span class="n">path_model</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv7_model.pkl&#39;</span><span class="p">,</span>
            <span class="mi">8</span> <span class="p">:</span> <span class="n">path_model</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv8_model.pkl&#39;</span><span class="p">,</span>
            <span class="mi">9</span> <span class="p">:</span> <span class="n">path_model</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv9_model.pkl&#39;</span><span class="p">,</span>
            <span class="mi">10</span> <span class="p">:</span> <span class="n">path_model</span> <span class="o">+</span> <span class="n">experiment_no_str</span> <span class="o">+</span> <span class="s1">&#39;_cv10_model.pkl&#39;</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">hyperparameter</span><span class="p">,</span><span class="n">experiment_no_str</span><span class="p">,</span> <span class="n">filepath</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.produce_forecast" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.produce_forecast" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Generate forecasts based on the model and its name.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model_name</code>
            </td>
            <td>
                  <code><span title="string">string</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Model identifier (e.g., 'm1_naive').</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Trained model object containing all relevant features.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of predictors for training set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Matrix of predictors for test set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y</code>
            </td>
            <td>
                  <code><span title="DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Target forecast y for training set.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Forecast horizon in minutes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>train_df_y_hat</code></td>            <td>
                  <code><span title="DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Forecasted values for training set.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>test_df_y_hat</code></td>            <td>
                  <code><span title="DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Forecasted values for test set.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Generate forecasts based on the model and its name.</span>

<span class="sd">    Args:</span>
<span class="sd">        model_name (string): Model identifier (e.g., &#39;m1_naive&#39;).</span>
<span class="sd">        model (dict): Trained model object containing all relevant features.</span>
<span class="sd">        train_df_X (DataFrame): Matrix of predictors for training set.</span>
<span class="sd">        test_df_X (DataFrame): Matrix of predictors for test set.</span>
<span class="sd">        train_df_y (DataFrame): Target forecast y for training set.</span>
<span class="sd">        forecast_horizon (int): Forecast horizon in minutes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (DataFrame): Forecasted values for training set.</span>
<span class="sd">        test_df_y_hat (DataFrame): Forecasted values for test set.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m1_naive&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m1_naive</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m2_snaive&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m2_snaive</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m3_ets&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m3_ets</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m4_arima&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m4_arima</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m5_sarima&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m5_sarima</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m6_lr&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m6_lr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m7_ann&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m7_ann</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m8_dnn&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m8_dnn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m9_rt&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m9_rt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m10_rf&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m10_rf</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m11_svr&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m11_svr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m12_rnn&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m12_rnn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m13_lstm&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m13_lstm</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m14_gru&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m14_gru</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m15_transformer&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m15_transformer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m16_prophet&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m16_prophet</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m17_xgb&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m17_xgb</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m18_nbeats&#39;</span><span class="p">:</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast_m18_nbeats</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Wrong Model Choice! Available models are: m1_naive, m2_snaive, m3_ets, m4_arima, m5_sarima, m6_lr, m7_ann, m8_dnn, m9_rt, m10_rf, m11_svr, m12_rnn, m13_lstm, m14_gru, m15_transformer, m16_prophet, m17_xgb, m18_nbeats&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.remove_jump_df" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_jump_df</span><span class="p">(</span><span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.remove_jump_df" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Remove jump in the time series data
Parameters:
    train_df_y (pd.Series): Time series data</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>train_df_y_updated</code></td>            <td>
                  <code><span title="pandas.Series">Series</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Time series data with jump removed</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_jump_df</span><span class="p">(</span><span class="n">train_df_y</span><span class="p">):</span>
    <span class="c1">#make docstring with the same format like other cells</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Remove jump in the time series data</span>
<span class="sd">    Parameters:</span>
<span class="sd">        train_df_y (pd.Series): Time series data</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_updated (pd.Series): Time series data with jump removed</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">time_diff</span> <span class="o">=</span> <span class="n">train_df_y</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>
    <span class="n">initial_freq</span> <span class="o">=</span> <span class="n">time_diff</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">jump_indices</span> <span class="o">=</span> <span class="n">time_diff</span><span class="p">[</span><span class="n">time_diff</span> <span class="o">&gt;</span> <span class="n">initial_freq</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">jump_indices</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">jump_index</span> <span class="o">=</span> <span class="n">jump_indices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">jump_pos</span> <span class="o">=</span> <span class="n">train_df_y</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">get_loc</span><span class="p">(</span><span class="n">jump_index</span><span class="p">)</span>
        <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">train_df_y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="n">jump_pos</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">train_df_y</span>
    <span class="k">return</span> <span class="n">train_df_y_updated</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.run_experiment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_experiment</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter_no</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.run_experiment" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Run the experiment with the specified parameters.
Args:
    dataset (str): Name of the dataset file.
    forecast_horizon (int): Forecast horizon in minutes.
    model_name (str): Model identifier (e.g., 'm6_lr').
    hyperparameter_no (str): Hyperparameter set identifier.</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>None. Results and models are saved to disk.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_experiment</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter_no</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Run the experiment with the specified parameters.</span>
<span class="sd">    Args:</span>
<span class="sd">        dataset (str): Name of the dataset file.</span>
<span class="sd">        forecast_horizon (int): Forecast horizon in minutes.</span>
<span class="sd">        model_name (str): Model identifier (e.g., &#39;m6_lr&#39;).</span>
<span class="sd">        hyperparameter_no (str): Hyperparameter set identifier.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None. Results and models are saved to disk.</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="c1"># PREPARE FOLDER</span>
    <span class="n">hyperparameter</span><span class="p">,</span> <span class="n">experiment_no_str</span><span class="p">,</span> <span class="n">filepath</span> <span class="o">=</span> <span class="n">prepare_directory</span><span class="p">(</span><span class="n">path_result</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter_no</span><span class="p">)</span>
    <span class="c1"># INPUT DATA</span>
    <span class="n">block_length</span><span class="p">,</span> <span class="n">holdout_df</span><span class="p">,</span> <span class="n">df</span> <span class="o">=</span> <span class="n">input_and_process</span><span class="p">(</span><span class="n">path_data_cleaned</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">max_lag_day</span><span class="p">,</span> <span class="n">n_block</span><span class="p">,</span> <span class="n">hyperparameter</span><span class="p">)</span>
    <span class="c1"># RUN MODEL</span>
    <span class="n">run_model</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">experiment_no_str</span><span class="p">,</span> <span class="n">block_length</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.run_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_model</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">experiment_no_str</span><span class="p">,</span> <span class="n">block_length</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.run_model" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Run model! This will be updated so that it can adapt to any model 
This consists of
1. Loop over all CV, then inside the loop,
2. Split df to train and test set
3. Train model on train set
4. Produce naive forecast on both trian and test set for benchmark
5. Produce forecast on both train and test set
6. Compute residual on both train and test set
7. Export the observation, naive, forecast, and residual of train and test set
8. Produce plots only on CV 1
9. Evaluate forecast performance on train and test set
10. Quit the loop,
11. Summarise the overall performance of the model using RMSE and its Stddev
12. Export all results     </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>df that will be used for training and validation (test) set, consists of X and Y</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model_name</code>
            </td>
            <td>
                  <code><span title="string">string</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>eg 'm06_lr'</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter</code>
            </td>
            <td>
                  <code>pd series</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of hyperparameter for that model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary of filepaths for exporting result</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the forecast horizon</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>experiment_no </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the experiment no. in string</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>block_length </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>block length of one cross validation set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">run_model</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter</span><span class="p">,</span> <span class="n">filepath</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">,</span> <span class="n">experiment_no_str</span><span class="p">,</span> <span class="n">block_length</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Run model! This will be updated so that it can adapt to any model </span>
<span class="sd">    This consists of</span>
<span class="sd">    1. Loop over all CV, then inside the loop,</span>
<span class="sd">    2. Split df to train and test set</span>
<span class="sd">    3. Train model on train set</span>
<span class="sd">    4. Produce naive forecast on both trian and test set for benchmark</span>
<span class="sd">    5. Produce forecast on both train and test set</span>
<span class="sd">    6. Compute residual on both train and test set</span>
<span class="sd">    7. Export the observation, naive, forecast, and residual of train and test set</span>
<span class="sd">    8. Produce plots only on CV 1</span>
<span class="sd">    9. Evaluate forecast performance on train and test set</span>
<span class="sd">    10. Quit the loop,</span>
<span class="sd">    11. Summarise the overall performance of the model using RMSE and its Stddev</span>
<span class="sd">    12. Export all results     </span>

<span class="sd">    Args:</span>
<span class="sd">        df (df): df that will be used for training and validation (test) set, consists of X and Y</span>
<span class="sd">        model_name (string): eg &#39;m06_lr&#39;</span>
<span class="sd">        hyperparameter (pd series): list of hyperparameter for that model</span>
<span class="sd">        filepath (dict): dictionary of filepaths for exporting result</span>
<span class="sd">        forecast_horizon : the forecast horizon</span>
<span class="sd">        experiment_no : the experiment no. in string</span>
<span class="sd">        block_length : block length of one cross validation set</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="kn">import</span> <span class="nn">warnings</span>
    <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>

    <span class="n">cross_val_result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="c1"># Compute max_y for normalization later</span>
    <span class="n">max_y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="c1"># DO CROSS VALIDATION</span>
    <span class="k">for</span> <span class="n">cv_no</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k</span><span class="o">+</span><span class="mi">1</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing CV </span><span class="si">{</span><span class="n">cv_no</span><span class="si">}</span><span class="s1"> / </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s1">....&#39;</span><span class="p">)</span>

        <span class="c1"># SPLIT INTO TRAIN AND TEST X AND Y</span>
        <span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span> <span class="o">=</span> <span class="n">split_time_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cv_no</span><span class="p">)</span>
        <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span> <span class="o">=</span> <span class="n">split_xy</span><span class="p">(</span><span class="n">train_df</span><span class="p">)</span>
        <span class="n">test_df_X</span><span class="p">,</span> <span class="n">test_df_y</span> <span class="o">=</span> <span class="n">split_xy</span><span class="p">(</span><span class="n">test_df</span><span class="p">)</span>

        <span class="c1"># INITIALISE RESULT DF   </span>
        <span class="n">train_result</span> <span class="o">=</span> <span class="n">train_df_y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">train_result</span> <span class="o">=</span> <span class="n">train_result</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;observation&#39;</span><span class="p">})</span>

        <span class="n">test_result</span> <span class="o">=</span> <span class="n">test_df_y</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">test_result</span> <span class="o">=</span> <span class="n">test_result</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="s1">&#39;observation&#39;</span><span class="p">})</span>

        <span class="c1"># PRODUCE NAIVE FORECAST</span>
        <span class="n">horizon_timedelta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">forecast_horizon</span><span class="p">)</span>
        <span class="n">last_observation</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;y_lag_</span><span class="si">{</span><span class="n">horizon_timedelta</span><span class="si">}</span><span class="s1">m&#39;</span>
        <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;naive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_df</span><span class="p">[</span><span class="n">last_observation</span><span class="p">]</span>
        <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;naive&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="n">last_observation</span><span class="p">]</span>

        <span class="c1"># TRAIN MODEL</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span>
        <span class="n">save_model</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">cv_no</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">runtime_ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># Convert to milliseconds</span>

        <span class="c1"># PRODUCE FORECAST</span>
        <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span>
        <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_df_y_hat</span>
        <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_df_y_hat</span>

        <span class="c1"># EVALUATE FORECAST</span>
        <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">]</span>
        <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">]</span>
        <span class="n">train_R2</span> <span class="o">=</span> <span class="n">compute_R2</span><span class="p">(</span><span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">])</span>
        <span class="n">test_R2</span> <span class="o">=</span> <span class="n">compute_R2</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">])</span>

        <span class="n">train_RMSE</span> <span class="o">=</span> <span class="n">compute_RMSE</span><span class="p">(</span><span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">])</span>
        <span class="n">test_RMSE</span> <span class="o">=</span> <span class="n">compute_RMSE</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">])</span>

        <span class="n">train_nRMSE</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">train_RMSE</span> <span class="o">/</span> <span class="n">max_y</span> <span class="c1"># in percent</span>
        <span class="n">test_nRMSE</span> <span class="o">=</span> <span class="mi">100</span><span class="o">*</span><span class="n">test_RMSE</span> <span class="o">/</span> <span class="n">max_y</span> <span class="c1"># in percent</span>

        <span class="n">cross_val_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;runtime_ms&quot;</span><span class="p">:</span> <span class="n">runtime_ms</span><span class="p">,</span>
            <span class="s2">&quot;train_MBE&quot;</span><span class="p">:</span> <span class="n">compute_MBE</span><span class="p">(</span><span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">]),</span> 
            <span class="s2">&quot;train_MAE&quot;</span><span class="p">:</span> <span class="n">compute_MAE</span><span class="p">(</span><span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">]),</span>
            <span class="s2">&quot;train_RMSE&quot;</span><span class="p">:</span> <span class="n">train_RMSE</span><span class="p">,</span>
            <span class="s2">&quot;train_MAPE&quot;</span><span class="p">:</span> <span class="n">compute_MAPE</span><span class="p">(</span><span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">]),</span>
            <span class="s2">&quot;train_MASE&quot;</span><span class="p">:</span> <span class="n">compute_MASE</span><span class="p">(</span><span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">],</span> <span class="n">train_result</span><span class="p">),</span>
            <span class="s2">&quot;train_fskill&quot;</span><span class="p">:</span> <span class="n">compute_fskill</span><span class="p">(</span><span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">],</span> <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;naive&#39;</span><span class="p">]),</span>
            <span class="s2">&quot;train_R2&quot;</span><span class="p">:</span> <span class="n">train_R2</span><span class="p">,</span>
            <span class="s2">&quot;test_MBE&quot;</span><span class="p">:</span> <span class="n">compute_MBE</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">]),</span>
            <span class="s2">&quot;test_MAE&quot;</span><span class="p">:</span> <span class="n">compute_MAE</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">]),</span>
            <span class="s2">&quot;test_RMSE&quot;</span><span class="p">:</span> <span class="n">test_RMSE</span><span class="p">,</span>
            <span class="s2">&quot;test_MAPE&quot;</span><span class="p">:</span> <span class="n">compute_MAPE</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">]),</span>
            <span class="s2">&quot;test_MASE&quot;</span><span class="p">:</span> <span class="n">compute_MASE</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">],</span> <span class="n">train_result</span><span class="p">),</span>
            <span class="s2">&quot;test_fskill&quot;</span><span class="p">:</span> <span class="n">compute_fskill</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">],</span> <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;naive&#39;</span><span class="p">]),</span>
            <span class="s2">&quot;test_R2&quot;</span><span class="p">:</span> <span class="n">test_R2</span><span class="p">,</span>
            <span class="s2">&quot;train_nRMSE&quot;</span><span class="p">:</span> <span class="n">train_nRMSE</span><span class="p">,</span>
            <span class="s2">&quot;test_nRMSE&quot;</span><span class="p">:</span> <span class="n">test_nRMSE</span>
        <span class="p">},</span> 
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">cv_no</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="k">if</span> <span class="n">cross_val_result_df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="n">cross_val_result_df</span> <span class="o">=</span> <span class="n">cross_val_result</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">cross_val_result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cross_val_result_df</span><span class="p">,</span> <span class="n">cross_val_result</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="n">cross_val_result_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;cv_no&#39;</span>

        <span class="c1"># EXPORT RESULTS DF TO CSV</span>
        <span class="n">train_result</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;train_cv&#39;</span><span class="p">][</span><span class="n">cv_no</span><span class="p">])</span>
        <span class="n">test_result</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;test_cv&#39;</span><span class="p">][</span><span class="n">cv_no</span><span class="p">])</span>

        <span class="c1"># IF CV_NO = 1, ALSO EXPORT SOME PLOTS</span>
        <span class="k">if</span> <span class="n">cv_no</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">timeplot_forecast</span><span class="p">(</span><span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">],</span> <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;b1&#39;</span><span class="p">])</span>
            <span class="n">timeplot_forecast</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">],</span> <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;c1&#39;</span><span class="p">])</span>
            <span class="n">scatterplot_forecast</span><span class="p">(</span><span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">],</span> <span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">train_R2</span><span class="p">,</span> <span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;b2&#39;</span><span class="p">])</span>
            <span class="n">scatterplot_forecast</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;observation&#39;</span><span class="p">],</span> <span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;forecast&#39;</span><span class="p">],</span> <span class="n">test_R2</span><span class="p">,</span> <span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;c2&#39;</span><span class="p">])</span>
            <span class="n">timeplot_residual</span><span class="p">(</span><span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">],</span> <span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;b3&#39;</span><span class="p">])</span>
            <span class="n">timeplot_residual</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">],</span> <span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;c3&#39;</span><span class="p">])</span>
            <span class="n">histogram_residual</span><span class="p">(</span><span class="n">train_result</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">,</span> <span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;b4&#39;</span><span class="p">])</span>
            <span class="n">histogram_residual</span><span class="p">(</span><span class="n">test_result</span><span class="p">[</span><span class="s1">&#39;residual&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">,</span> <span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;c4&#39;</span><span class="p">])</span>
        <span class="nb">print</span><span class="p">()</span>


    <span class="n">cross_val_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;runtime_ms&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;runtime_ms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;runtime_ms&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;train_MBE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_MBE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_MBE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span> 
            <span class="s2">&quot;train_MAE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_MAE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_MAE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;train_RMSE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_RMSE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_RMSE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;train_MAPE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_MAPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_MAPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;train_MASE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_MASE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_MASE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;train_fskill&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_fskill&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_fskill&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;train_R2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_R2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_R2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;test_MBE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_MBE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_MBE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;test_MAE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_MAE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_MAE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;test_RMSE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_RMSE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_RMSE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;test_MAPE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_MAPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_MAPE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;test_MASE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_MASE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_MASE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;test_fskill&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_fskill&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_fskill&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;test_R2&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_R2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_R2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;train_nRMSE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_nRMSE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;train_nRMSE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()],</span>
            <span class="s2">&quot;test_nRMSE&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_nRMSE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">cross_val_result_df</span><span class="p">[</span><span class="s1">&#39;test_nRMSE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">std</span><span class="p">()]</span>
        <span class="p">},</span> 
        <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;stddev&#39;</span><span class="p">]</span>
        <span class="p">)</span>

    <span class="n">cross_val_result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">cross_val_result_df</span><span class="p">,</span> <span class="n">cross_val_result</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="n">data_a1</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;experiment_no&quot;</span><span class="p">:</span> <span class="n">experiment_no_str</span><span class="p">,</span>
        <span class="s2">&quot;exp_date&quot;</span><span class="p">:</span> <span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">),</span> <span class="c1">#today date in YYYY-MM-DD format</span>
        <span class="s2">&quot;dataset_no&quot;</span><span class="p">:</span> <span class="n">dataset</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="n">dataset</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;dataset_freq_min&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span><span class="p">),</span>
        <span class="s2">&quot;dataset_length_week&quot;</span><span class="p">:</span> <span class="n">block_length</span> <span class="o">*</span> <span class="p">(</span><span class="n">n_block</span> <span class="o">-</span> <span class="mi">1</span><span class="p">),</span>
        <span class="s2">&quot;forecast_horizon_min&quot;</span><span class="p">:</span> <span class="n">forecast_horizon</span><span class="p">,</span>
        <span class="s2">&quot;train_pct&quot;</span><span class="p">:</span> <span class="n">train_pct</span><span class="p">,</span>
        <span class="s2">&quot;test_pct&quot;</span><span class="p">:</span> <span class="n">test_pct</span><span class="p">,</span>
        <span class="s2">&quot;model_no&quot;</span><span class="p">:</span> <span class="n">model_name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span>
        <span class="s2">&quot;hyperparameter_no&quot;</span><span class="p">:</span> <span class="n">hyperparameter_no</span><span class="p">,</span>
        <span class="s2">&quot;model_name&quot;</span><span class="p">:</span> <span class="n">model_name</span> <span class="o">+</span> <span class="s1">&#39;_&#39;</span> <span class="o">+</span> <span class="n">hyperparameter_no</span><span class="p">,</span>
        <span class="s2">&quot;hyperparamter&quot;</span><span class="p">:</span> <span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">hyperparameter</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span>  
        <span class="s2">&quot;runtime_ms&quot;</span><span class="p">:</span> <span class="n">cross_val_result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;runtime_ms&#39;</span><span class="p">],</span>
        <span class="s2">&quot;train_RMSE&quot;</span><span class="p">:</span> <span class="n">cross_val_result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;train_RMSE&#39;</span><span class="p">],</span>
        <span class="s2">&quot;train_RMSE_stddev&quot;</span><span class="p">:</span> <span class="n">cross_val_result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">,</span> <span class="s1">&#39;train_RMSE&#39;</span><span class="p">],</span>
        <span class="s2">&quot;test_RMSE&quot;</span><span class="p">:</span> <span class="n">cross_val_result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;test_RMSE&#39;</span><span class="p">],</span>
        <span class="s2">&quot;test_RMSE_stddev&quot;</span><span class="p">:</span> <span class="n">cross_val_result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">,</span> <span class="s1">&#39;test_RMSE&#39;</span><span class="p">],</span>
        <span class="s2">&quot;train_nRMSE&quot;</span><span class="p">:</span> <span class="n">cross_val_result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;train_nRMSE&#39;</span><span class="p">],</span>
        <span class="s2">&quot;train_nRMSE_stddev&quot;</span><span class="p">:</span> <span class="n">cross_val_result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">,</span> <span class="s1">&#39;train_nRMSE&#39;</span><span class="p">],</span>
        <span class="s2">&quot;test_nRMSE&quot;</span><span class="p">:</span> <span class="n">cross_val_result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="s1">&#39;test_nRMSE&#39;</span><span class="p">],</span>
        <span class="s2">&quot;test_nRMSE_stddev&quot;</span><span class="p">:</span> <span class="n">cross_val_result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;stddev&#39;</span><span class="p">,</span> <span class="s1">&#39;test_nRMSE&#39;</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="c1"># Create a df of experiment result</span>
    <span class="n">df_a1_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">data_a1</span><span class="p">])</span>

    <span class="n">export_result</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">df_a1_result</span><span class="p">,</span> <span class="n">cross_val_result_df</span><span class="p">,</span> <span class="n">hyperparameter</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.save_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_model</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">cv_no</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.save_model" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Export model into binary file using pickle to a designated file</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>filepath</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>dictionary of the file path</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cv_no (int) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>cv number</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="n">filepath</span><span class="p">,</span> <span class="n">cv_no</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Export model into binary file using pickle to a designated file</span>

<span class="sd">    Args:</span>
<span class="sd">        filepath (dictionary): dictionary of the file path</span>
<span class="sd">        cv_no (int) : cv number</span>
<span class="sd">        model (dictionary): trained model</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">][</span><span class="n">cv_no</span><span class="p">],</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">model_file</span><span class="p">:</span>
        <span class="c1"># pickle.dump(model, model_file)</span>
        <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">model_file</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.scatterplot_forecast" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scatterplot_forecast</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">forecast</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">pathname</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.scatterplot_forecast" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Produce scatterplot observation vs forecast value and save it on the designated folder</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>observation</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>observed value</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast value</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pathname</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filepath to save the figure</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">scatterplot_forecast</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">forecast</span><span class="p">,</span> <span class="n">R2</span><span class="p">,</span> <span class="n">pathname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produce scatterplot observation vs forecast value and save it on the designated folder</span>

<span class="sd">    Args:</span>
<span class="sd">        observation (df): observed value</span>
<span class="sd">        forecast (df): forecast value</span>
<span class="sd">        pathname (str): filepath to save the figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create the figure with specified size</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

    <span class="c1"># Set background color</span>
    <span class="c1"># plt.gcf().patch.set_facecolor(platinum)</span>

    <span class="c1"># Plot the actual and forecast data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">forecast</span><span class="p">,</span> <span class="n">observation</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>  <span class="c1"># &#39;s&#39; sets the size of the points</span>


    <span class="c1"># Set the font to Arial</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Arial&#39;</span>

    <span class="c1"># Remove grid lines</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Set tick marks for x and y axis</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Add borders to the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>

    <span class="c1"># Remove the tick markers (the small lines)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Remove x-axis tick markers</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Remove y-axis tick markers</span>

    <span class="c1"># Set axis titles</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Net Load Forecast (kW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Net Load Observation (kW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">)</span>

    <span class="c1"># Remove title</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="c1"># Add R value at the top-left corner</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;R = </span><span class="si">{</span><span class="n">R2</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span> <span class="n">transform</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> 
         <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span> <span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span>
         <span class="n">bbox</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">facecolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">boxstyle</span><span class="o">=</span><span class="s1">&#39;round,pad=0.5&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>


    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.separate_holdout" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">separate_holdout</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_block</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.separate_holdout" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Separating df into two parts:
1. df : df that will be used for training and blocked k-fold cross validation. 
The block is a multiple of a week because net load data has weekly seasonality
2. hold_out_df : this section is not used for now, but can be useful for final test of the chosen model
if wanted, to show the generalized error. This is at least 1 block of data. </p>
<p>By default, the chosen k for k-fold cross validation is 10.</p>
<p>For example, the original df has 12 weeks worth of data. 
In this case,
new df is week 1-10,
hold_out_df is week 11-12,</p>
<p>the new df will be used for cross validation, for example
CV1: training: week 1-9, validation (test) week 10
CV2: training: week 1-8, week 10, validation (test) week 9,
etc. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>cleaned df consisting of y and all predictors</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_block</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of blocks to divide the original df. This includes the block for hold_out_df, so if k=10, this n_block = k+1 = 11</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>block_length (int) : number of weeks per block</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hodout_df (df) : unused df, can be used later for unbiased estimate of final model performance</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>df (df) : df that will be used for training and validation (test) set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">separate_holdout</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_block</span><span class="p">):</span>    
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Separating df into two parts:</span>
<span class="sd">    1. df : df that will be used for training and blocked k-fold cross validation. </span>
<span class="sd">    The block is a multiple of a week because net load data has weekly seasonality</span>
<span class="sd">    2. hold_out_df : this section is not used for now, but can be useful for final test of the chosen model</span>
<span class="sd">    if wanted, to show the generalized error. This is at least 1 block of data. </span>

<span class="sd">    By default, the chosen k for k-fold cross validation is 10.</span>

<span class="sd">    For example, the original df has 12 weeks worth of data. </span>
<span class="sd">    In this case,</span>
<span class="sd">    new df is week 1-10,</span>
<span class="sd">    hold_out_df is week 11-12,</span>

<span class="sd">    the new df will be used for cross validation, for example</span>
<span class="sd">    CV1: training: week 1-9, validation (test) week 10</span>
<span class="sd">    CV2: training: week 1-8, week 10, validation (test) week 9,</span>
<span class="sd">    etc. </span>

<span class="sd">    Args:</span>
<span class="sd">        df (df): cleaned df consisting of y and all predictors</span>
<span class="sd">        n_block (int): number of blocks to divide the original df. This includes the block for hold_out_df, so if k=10, this n_block = k+1 = 11</span>

<span class="sd">    Returns:</span>
<span class="sd">        block_length (int) : number of weeks per block</span>
<span class="sd">        hodout_df (df) : unused df, can be used later for unbiased estimate of final model performance</span>
<span class="sd">        df (df) : df that will be used for training and validation (test) set</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">dataset_length_week</span><span class="o">=</span> <span class="p">((</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">86400</span><span class="o">/</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">block_length</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">dataset_length_week</span> <span class="o">/</span> <span class="n">n_block</span><span class="p">)</span>
    <span class="n">consecutive_timedelta</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_timestep_per_week</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">one_week</span> <span class="o">/</span> <span class="n">consecutive_timedelta</span><span class="p">)</span>
    <span class="n">holdout_start</span> <span class="o">=</span> <span class="p">(</span><span class="n">n_block</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span><span class="o">*</span> <span class="n">block_length</span> <span class="o">*</span> <span class="n">n_timestep_per_week</span>
    <span class="n">holdout_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">holdout_start</span><span class="p">:]</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">holdout_start</span><span class="p">:])</span>

    <span class="k">return</span> <span class="n">block_length</span><span class="p">,</span> <span class="n">holdout_df</span><span class="p">,</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.split_time_series" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split_time_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cv_no</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.split_time_series" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Split df to train and test set using blocked cross validation.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>df that will be used for training and validation (test) set, consists of X and Y</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cv_no</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>number of current cv order. 
         cv_no=1 means the test set is at the last, cv_no = k means the test set is at the beginning</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df (df) : df used for training</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df (df) : df used for validation, formal name is validation set / dev set.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_time_series</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">cv_no</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Split df to train and test set using blocked cross validation.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (df): df that will be used for training and validation (test) set, consists of X and Y</span>
<span class="sd">        cv_no (int): number of current cv order. </span>
<span class="sd">                     cv_no=1 means the test set is at the last, cv_no = k means the test set is at the beginning</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df (df) : df used for training</span>
<span class="sd">        test_df (df) : df used for validation, formal name is validation set / dev set. </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    <span class="n">test_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">cv_no</span><span class="o">*</span><span class="n">test_pct</span><span class="p">))</span>
    <span class="n">test_end</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">n</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="n">cv_no</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">test_pct</span><span class="p">))</span>

    <span class="n">test_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">test_start</span><span class="p">:</span><span class="n">test_end</span><span class="p">]</span>
    <span class="n">train_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">test_start</span><span class="p">:</span><span class="n">test_end</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">train_df</span><span class="p">,</span> <span class="n">test_df</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.split_xy" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">split_xy</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.split_xy" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>separate forecast target y and all predictors X into two dfs</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>df</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>df containing the forecast target y and all predictors X</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


<details class="return" open>
  <summary>Return</summary>
  <p>df_X (df): df of all predictors X
df_y (df): df of target forecast y</p>
</details>

            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">split_xy</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;separate forecast target y and all predictors X into two dfs</span>

<span class="sd">    Args:</span>
<span class="sd">        df (df): df containing the forecast target y and all predictors X</span>

<span class="sd">    Return:</span>
<span class="sd">        df_X (df): df of all predictors X</span>
<span class="sd">        df_y (df): df of target forecast y</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">df_y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;y&#39;</span><span class="p">]]</span>
    <span class="n">df_X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df_X</span><span class="p">,</span> <span class="n">df_y</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.timeplot_forecast" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">timeplot_forecast</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">forecast</span><span class="p">,</span> <span class="n">pathname</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.timeplot_forecast" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Produce time plot of observation vs forecast value and save it on the designated folder</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>observation</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>observed value</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast value</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pathname</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filepath to save the figure</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span>
<span class="normal">978</span>
<span class="normal">979</span>
<span class="normal">980</span>
<span class="normal">981</span>
<span class="normal">982</span>
<span class="normal">983</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">timeplot_forecast</span><span class="p">(</span><span class="n">observation</span><span class="p">,</span> <span class="n">forecast</span><span class="p">,</span> <span class="n">pathname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produce time plot of observation vs forecast value and save it on the designated folder</span>

<span class="sd">    Args:</span>
<span class="sd">        observation (df): observed value</span>
<span class="sd">        forecast (df): forecast value</span>
<span class="sd">        pathname (str): filepath to save the figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">consecutive_timedelta</span> <span class="o">=</span> <span class="n">observation</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">observation</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1"># Calculate total minutes in a week</span>
    <span class="n">minutes_per_week</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># 7 days * 24 hours * 60 minutes</span>

    <span class="c1"># Calculate the number of minutes per timestep</span>
    <span class="n">minutes_per_timestep</span> <span class="o">=</span> <span class="n">consecutive_timedelta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>  <span class="c1"># convert seconds to minutes</span>

    <span class="c1"># Compute the number of timesteps in a week</span>
    <span class="n">timesteps_per_week</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">minutes_per_week</span> <span class="o">/</span> <span class="n">minutes_per_timestep</span><span class="p">)</span>

    <span class="c1"># Create the figure with specified size</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

    <span class="c1"># Set background color</span>
    <span class="c1"># plt.gcf().patch.set_facecolor(platinum)</span>

    <span class="c1"># Plot the actual and forecast data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">observation</span><span class="p">[</span><span class="o">-</span><span class="n">timesteps_per_week</span><span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">forecast</span><span class="p">[</span><span class="o">-</span><span class="n">timesteps_per_week</span><span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="n">orange</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Forecast&#39;</span><span class="p">)</span>

    <span class="c1"># Set the font to Arial</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Arial&#39;</span>

    <span class="c1"># Remove grid lines</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Set tick marks for x and y axis</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Add borders to the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>

    <span class="c1"># Remove the tick markers (the small lines)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Remove x-axis tick markers</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Remove y-axis tick markers</span>

    <span class="c1"># Set axis titles</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Net Load (kW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">)</span>

    <span class="c1"># Remove title</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">frameon</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">labelspacing</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.timeplot_residual" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">timeplot_residual</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">pathname</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.timeplot_residual" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Produce time plot of resodia; value and save it on the designated folder</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>residual</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast - observation</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pathname</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>filepath to save the figure</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">timeplot_residual</span><span class="p">(</span><span class="n">residual</span><span class="p">,</span> <span class="n">pathname</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Produce time plot of resodia; value and save it on the designated folder</span>

<span class="sd">    Args:</span>
<span class="sd">        residual (df): forecast - observation</span>
<span class="sd">        pathname (str): filepath to save the figure</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">consecutive_timedelta</span> <span class="o">=</span> <span class="n">residual</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">residual</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="c1"># Calculate total minutes in a week</span>
    <span class="n">minutes_per_week</span> <span class="o">=</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span>  <span class="c1"># 7 days * 24 hours * 60 minutes</span>

    <span class="c1"># Calculate the number of minutes per timestep</span>
    <span class="n">minutes_per_timestep</span> <span class="o">=</span> <span class="n">consecutive_timedelta</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span>  <span class="c1"># convert seconds to minutes</span>

    <span class="c1"># Compute the number of timesteps in a week</span>
    <span class="n">timesteps_per_week</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">minutes_per_week</span> <span class="o">/</span> <span class="n">minutes_per_timestep</span><span class="p">)</span>

    <span class="c1"># Create the figure with specified size</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span> <span class="mi">9</span><span class="p">))</span>

    <span class="c1"># Set background color</span>
    <span class="c1"># plt.gcf().patch.set_facecolor(platinum)</span>

    <span class="c1"># Plot the actual and forecast data</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">residual</span><span class="p">[</span><span class="o">-</span><span class="n">timesteps_per_week</span><span class="p">:],</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>

    <span class="c1"># Set the font to Arial</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;font.family&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;Arial&#39;</span>

    <span class="c1"># Remove grid lines</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Set tick marks for x and y axis</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># Add borders to the plot</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;top&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;right&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;bottom&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">spines</span><span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">dark_blue</span><span class="p">)</span>

    <span class="c1"># Remove the tick markers (the small lines)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Remove x-axis tick markers</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Remove y-axis tick markers</span>

    <span class="c1"># Set axis titles</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Forecast Residual (kW)&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">14</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">dark_blue</span><span class="p">)</span>

    <span class="c1"># Remove title</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">pathname</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;png&#39;</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.config.general_functions.train_model" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span></code>

<a href="#docs.notebooks.config.general_functions.train_model" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>train model based on the model choice, hyperparamter, predictors X and target y</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model_name</code>
            </td>
            <td>
                  <code><span title="string">string</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>eg 'm06_lr'</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter</code>
            </td>
            <td>
                  <code>pd series</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>list of hyperparameter for that model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>matrix of predictors</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target forecast y</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Forecast horizon in minutes.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (dict) : general object storing all models info including the predictor, feature selection, </p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>and all other relevant features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\config\general_functions.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">,</span> <span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;train model based on the model choice, hyperparamter, predictors X and target y</span>

<span class="sd">    Args:</span>
<span class="sd">        model_name (string): eg &#39;m06_lr&#39;</span>
<span class="sd">        hyperparameter (pd series): list of hyperparameter for that model</span>
<span class="sd">        train_df_X (df): matrix of predictors</span>
<span class="sd">        train_df_y (df): target forecast y</span>
<span class="sd">        forecast_horizon (int): Forecast horizon in minutes.</span>

<span class="sd">    Returns:</span>
<span class="sd">        model (dict) : general object storing all models info including the predictor, feature selection, </span>
<span class="sd">        and all other relevant features</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m1_naive&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m1_naive</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m2_snaive&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m2_snaive</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m3_ets&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m3_ets</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m4_arima&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m4_arima</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m5_sarima&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m5_sarima</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m6_lr&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m6_lr</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m7_ann&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m7_ann</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m8_dnn&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m8_dnn</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m9_rt&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m9_rt</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m10_rf&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m10_rf</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m11_svr&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m11_svr</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m12_rnn&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m12_rnn</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m13_lstm&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m13_lstm</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m14_gru&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m14_gru</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m15_transformer&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m15_transformer</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m16_prophet&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m16_prophet</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m17_xgb&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m17_xgb</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">model_name</span> <span class="o">==</span> <span class="s1">&#39;m18_nbeats&#39;</span><span class="p">:</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">train_model_m18_nbeats</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Wrong Model Choice! Available models are: m1_naive, m2_snaive, m3_ets, m4_arima, m5_sarima, m6_lr, m7_ann, m8_dnn, m9_rt, m10_rf, m11_svr, m12_rnn, m13_lstm, m14_gru, m15_transformer, m16_prophet, m17_xgb, m18_nbeats&quot;</span>
        <span class="p">)</span>

    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.config.model_hyperparameters"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">












  </div>

    </div>

</div><h2 id="folder-model">Folder <code>Model/</code><a class="headerlink" href="#folder-model" title="Permanent link">&para;</a></h2>


<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m1_naive"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m1_naive.produce_forecast_m1_naive" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m1_naive</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m1_naive.produce_forecast_m1_naive" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m1_naive.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m1_naive</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># PRODUCE FORECAST</span>
    <span class="n">horizon_timedelta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="n">last_observation</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;y_lag_</span><span class="si">{</span><span class="n">horizon_timedelta</span><span class="si">}</span><span class="s1">m&#39;</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">train_df_X</span><span class="p">[</span><span class="n">last_observation</span><span class="p">]</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="p">[</span><span class="n">last_observation</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m1_naive.train_model_m1_naive" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m1_naive</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m1_naive.train_model_m1_naive" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a naive model for point forecasting. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m1_naive.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m1_naive</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a naive model for point forecasting. </span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>


<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="c1">#no hyperparameter for naive model</span>

    <span class="c1">#TRAIN MODEL</span>
    <span class="c1">#no training is required for naive model</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{}</span>


    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m2_snaive"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m2_snaive.produce_forecast_m2_snaive" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m2_snaive</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m2_snaive.produce_forecast_m2_snaive" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m2_snaive.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m2_snaive</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># UNPACK MODEL</span>
    <span class="n">col_name</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;col_name&#39;</span><span class="p">]</span>  <span class="c1">#this depends on the lag day</span>

    <span class="c1"># PRODUCE FORECAST</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">train_df_X</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="p">[</span><span class="n">col_name</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m2_snaive.train_model_m2_snaive" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m2_snaive</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m2_snaive.train_model_m2_snaive" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a seasonal model for point forecasting. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m2_snaive.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m2_snaive</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a seasonal model for point forecasting. </span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>


<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="n">days</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;days&#39;</span><span class="p">]</span>
    <span class="n">col_name</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;y_lag_</span><span class="si">{</span><span class="n">days</span><span class="si">}</span><span class="s1"> days 00:00:00m&#39;</span>

    <span class="c1">#TRAIN MODEL</span>
    <span class="c1">#no training is required for seasonal naive model</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;col_name&quot;</span><span class="p">:</span> <span class="n">col_name</span> <span class="p">}</span>


    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m3_ets"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m3_ets.produce_forecast_m3_ets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m3_ets</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m3_ets.produce_forecast_m3_ets" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast horizon in mins</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m3_ets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m3_ets</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>
<span class="sd">        forecast_horizon (int): forecast horizon in mins</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">timestep_frequency</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_timestep_forecast_horizon</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">forecast_horizon</span> <span class="o">/</span> <span class="p">(</span><span class="n">timestep_frequency</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>


    <span class="n">train_df_X_updated</span> <span class="o">=</span> <span class="n">remove_jump_df</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">test_df_X_updated</span> <span class="o">=</span> <span class="n">remove_jump_df</span><span class="p">(</span><span class="n">test_df_X</span><span class="p">)</span>

    <span class="c1"># UNPACK MODEL</span>
    <span class="n">model_fitted</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;model_fitted&#39;</span><span class="p">]</span>

    <span class="c1"># PRODUCE FORECAST FOR TRAIN SET</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">model_fitted</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">)</span>
    <span class="n">train_df_y_hat</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

    <span class="c1"># train_df_y_hat_2 = pd.DataFrame(model_fitted.forecast(n_timestep_forecast_horizon-1))</span>
    <span class="c1"># train_df_y_hat_2.columns = [&#39;y&#39;]</span>
    <span class="c1"># train_df_y_hat = pd.concat([train_df_y_hat, train_df_y_hat_2])</span>

    <span class="n">train_df_y_hat</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;datetime&#39;</span>

    <span class="c1"># TRANSFORM test_df_X to a series with only the last lag</span>
    <span class="n">horizon_timedelta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="n">last_observation</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;y_lag_</span><span class="si">{</span><span class="n">horizon_timedelta</span><span class="si">}</span><span class="s1">m&#39;</span>
    <span class="n">test_df_y_last</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="p">[</span><span class="n">last_observation</span><span class="p">]</span>


    <span class="c1"># REFIT THE MODEL AND PRODUCE NEW FORECAST FOR TEST SET</span>
    <span class="c1"># THIS CODE RESULTS IN 2 MINS</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">test_df_y_hat</span><span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>


    <span class="c1"># in the case of CV 10, which is when test df &lt; train df</span>
    <span class="c1"># don&#39;t compute the test forecast</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">train_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="c1"># this is the case when we use CV10, where the test set is before the train set</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test set is before train set / CV 10, no test forecast can be made&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_df_y_last</span><span class="p">)):</span>
    <span class="c1"># for i in range(2): #for test only</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing i = &#39;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; out of &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_df_y_last</span><span class="p">)),</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">test_df_y_hat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_fitted</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_timestep_forecast_horizon</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">test_df_y_last</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">test_df_y_last</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">forecast_horizon</span><span class="p">)])</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">new_row</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">test_df_X_updated</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>

            <span class="n">model_fitted</span> <span class="o">=</span> <span class="n">model_fitted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
            <span class="n">test_df_y_hat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_fitted</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_timestep_forecast_horizon</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># to update based on the forecast horizon</span>

    <span class="c1"># test_df_y_hat = m06_lr.predict(test_df_X)</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m3_ets.train_model_m3_ets" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m3_ets</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m3_ets.train_model_m3_ets" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a linear model for point forecasting. 
https://www.statsmodels.org/dev/generated/statsmodels.tsa.statespace.exponential_smoothing.ExponentialSmoothing.html</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon (int) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast horizon in mins</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m3_ets.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m3_ets</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a linear model for point forecasting. </span>
<span class="sd">    https://www.statsmodels.org/dev/generated/statsmodels.tsa.statespace.exponential_smoothing.ExponentialSmoothing.html</span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>
<span class="sd">        forecast_horizon (int) : forecast horizon in mins</span>

<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="n">trend</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;trend&#39;</span><span class="p">]</span>
    <span class="n">damped_trend</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;damped_trend&#39;</span><span class="p">]</span>
    <span class="n">seasonal_periods_days</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;seasonal_periods_days&#39;</span><span class="p">]</span>

    <span class="c1"># UPDATE train_df_y to exclude all rows after a sudden jump in the timestep</span>
    <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">remove_jump_df</span><span class="p">(</span><span class="n">train_df_y</span><span class="p">)</span>

    <span class="c1"># TRAIN MODEL</span>
    <span class="c1"># Calculate the frequency of the timesteps using the first and second index values</span>
    <span class="n">timestep_frequency</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">inferred_frequency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">inferred_frequency</span><span class="p">)</span> 

    <span class="c1"># INTRODUCE GAP BETWEEN TRAIN AND TEST SET TO AVOID DATA LEAKAGE</span>
    <span class="n">n_timestep_forecast_horizon</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">forecast_horizon</span> <span class="o">/</span> <span class="p">(</span><span class="n">timestep_frequency</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">n_timestep_forecast_horizon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">n_timestep_forecast_horizon</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="c1"># Assuming train_df_y_updated is your dataframe and &#39;y&#39; is the column with the training series</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

   <span class="c1"># Build and fit the state-space Exponential Smoothing model</span>
    <span class="n">model_fitted</span> <span class="o">=</span> <span class="n">ExponentialSmoothing</span><span class="p">(</span>
        <span class="n">y</span><span class="p">,</span>
        <span class="n">trend</span><span class="o">=</span><span class="n">trend</span><span class="p">,</span>
        <span class="n">seasonal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="c1">#can be updated later</span>
        <span class="n">damped_trend</span><span class="o">=</span><span class="n">damped_trend</span>
    <span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>


    <span class="c1"># Print the model summary</span>
    <span class="c1"># print(model_fitted.summary())</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model_fitted&quot;</span><span class="p">:</span> <span class="n">model_fitted</span><span class="p">}</span>


    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m4_arima"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m4_arima.produce_forecast_m4_arima" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m4_arima</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m4_arima.produce_forecast_m4_arima" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast horizon in mins</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m4_arima.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m4_arima</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>
<span class="sd">        forecast_horizon (int): forecast horizon in mins</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timestep_frequency</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_timestep_forecast_horizon</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">forecast_horizon</span> <span class="o">/</span> <span class="p">(</span><span class="n">timestep_frequency</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>

    <span class="n">train_df_X_updated</span> <span class="o">=</span> <span class="n">remove_jump_df</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">test_df_X_updated</span> <span class="o">=</span> <span class="n">remove_jump_df</span><span class="p">(</span><span class="n">test_df_X</span><span class="p">)</span>

    <span class="c1"># UNPACK MODEL</span>
    <span class="n">model_fitted</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;model_fitted&#39;</span><span class="p">]</span>

    <span class="c1"># PRODUCE FORECAST FOR TRAIN SET</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">model_fitted</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">)</span>
    <span class="n">train_df_y_hat</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

    <span class="c1"># train_df_y_hat_2 = pd.DataFrame(model_fitted.forecast(n_timestep_forecast_horizon-1))</span>
    <span class="c1"># train_df_y_hat_2.columns = [&#39;y&#39;]</span>
    <span class="c1"># train_df_y_hat = pd.concat([train_df_y_hat, train_df_y_hat_2])</span>

    <span class="n">train_df_y_hat</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;datetime&#39;</span>

    <span class="c1"># TRANSFORM test_df_X to a series with only the last lag</span>
    <span class="n">horizon_timedelta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="n">last_observation</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;y_lag_</span><span class="si">{</span><span class="n">horizon_timedelta</span><span class="si">}</span><span class="s1">m&#39;</span>
    <span class="n">test_df_y_last</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="p">[</span><span class="n">last_observation</span><span class="p">]</span>


    <span class="c1"># REFIT THE MODEL AND PRODUCE NEW FORECAST FOR TEST SET</span>
    <span class="c1"># THIS CODE RESULTS IN 2 MINS</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">test_df_y_hat</span><span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># in the case of CV 10, which is when test df &lt; train df</span>
    <span class="c1"># don&#39;t compute the test forecast</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">train_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="c1"># this is the case when we use CV10, where the test set is before the train set</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test set is before train set / CV 10, no test forecast can be made&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_df_y_last</span><span class="p">)):</span>
    <span class="c1"># for i in range(2): #for test only</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing i = &#39;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; out of &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_df_y_last</span><span class="p">)),</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">test_df_y_hat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_fitted</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_timestep_forecast_horizon</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">test_df_y_last</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">test_df_y_last</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">forecast_horizon</span><span class="p">)])</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">new_row</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">test_df_X_updated</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>

            <span class="n">model_fitted</span> <span class="o">=</span> <span class="n">model_fitted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
            <span class="n">test_df_y_hat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_fitted</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_timestep_forecast_horizon</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># to update based on the forecast horizon</span>


    <span class="c1"># test_df_y_hat = m06_lr.predict(test_df_X)</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m4_arima.train_model_m4_arima" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m4_arima</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m4_arima.train_model_m4_arima" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a linear model for point forecasting. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon (int) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast horizon in mins</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m4_arima.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m4_arima</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a linear model for point forecasting. </span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>
<span class="sd">        forecast_horizon (int) : forecast horizon in mins</span>


<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span>


    <span class="c1"># UPDATE train_df_y to exclude all rows after a sudden jump in the timestep</span>
    <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">remove_jump_df</span><span class="p">(</span><span class="n">train_df_y</span><span class="p">)</span>

    <span class="c1"># TRAIN MODEL</span>
    <span class="c1"># Calculate the frequency of the timesteps using the first and second index values</span>
    <span class="n">timestep_frequency</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">inferred_frequency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">inferred_frequency</span><span class="p">)</span>

    <span class="c1"># INTRODUCE GAP BETWEEN TRAIN AND TEST SET TO AVOID DATA LEAKAGE</span>
    <span class="n">n_timestep_forecast_horizon</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">forecast_horizon</span> <span class="o">/</span> <span class="p">(</span><span class="n">timestep_frequency</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">n_timestep_forecast_horizon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">n_timestep_forecast_horizon</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="c1"># Assuming train_df_y_updated is your dataframe and &#39;y&#39; is the column with the training series</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

    <span class="c1"># Build and fit the state-space ARIMA model</span>
    <span class="n">model_fitted</span> <span class="o">=</span> <span class="n">ARIMA</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="n">inferred_frequency</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model_fitted&quot;</span><span class="p">:</span> <span class="n">model_fitted</span><span class="p">}</span>


    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m5_sarima"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m5_sarima.produce_forecast_m5_sarima" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m5_sarima</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m5_sarima.produce_forecast_m5_sarima" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast horizon in mins</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m5_sarima.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m5_sarima</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>
<span class="sd">        forecast_horizon (int): forecast horizon in mins</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">timestep_frequency</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_timestep_forecast_horizon</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">forecast_horizon</span> <span class="o">/</span> <span class="p">(</span><span class="n">timestep_frequency</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>

    <span class="n">train_df_X_updated</span> <span class="o">=</span> <span class="n">remove_jump_df</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">test_df_X_updated</span> <span class="o">=</span> <span class="n">remove_jump_df</span><span class="p">(</span><span class="n">test_df_X</span><span class="p">)</span>

    <span class="c1"># UNPACK MODEL</span>
    <span class="n">model_fitted</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;model_fitted&#39;</span><span class="p">]</span>

    <span class="c1"># PRODUCE FORECAST FOR TRAIN SET</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">model_fitted</span><span class="o">.</span><span class="n">fittedvalues</span><span class="p">)</span>
    <span class="n">train_df_y_hat</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

    <span class="c1"># train_df_y_hat_2 = pd.DataFrame(model_fitted.forecast(n_timestep_forecast_horizon-1))</span>
    <span class="c1"># train_df_y_hat_2.columns = [&#39;y&#39;]</span>
    <span class="c1"># train_df_y_hat = pd.concat([train_df_y_hat, train_df_y_hat_2])</span>

    <span class="n">train_df_y_hat</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;datetime&#39;</span>

    <span class="c1"># TRANSFORM test_df_X to a series with only the last lag</span>
    <span class="n">horizon_timedelta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="n">last_observation</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;y_lag_</span><span class="si">{</span><span class="n">horizon_timedelta</span><span class="si">}</span><span class="s1">m&#39;</span>
    <span class="n">test_df_y_last</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="p">[</span><span class="n">last_observation</span><span class="p">]</span>


    <span class="c1"># REFIT THE MODEL AND PRODUCE NEW FORECAST FOR TEST SET</span>
    <span class="c1"># THIS CODE RESULTS IN 2 MINS</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">test_df_y_hat</span><span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># in the case of CV 10, which is when test df &lt; train df</span>
    <span class="c1"># don&#39;t compute the test forecast</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">train_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="c1"># this is the case when we use CV10, where the test set is before the train set</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test set is before train set / CV 10, no test forecast can be made&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_df_y_last</span><span class="p">)):</span>
    <span class="c1"># for i in range(2): #for test only</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing i = &#39;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; out of &#39;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">test_df_y_last</span><span class="p">)),</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">test_df_y_hat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_fitted</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_timestep_forecast_horizon</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">test_df_y_last</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="n">i</span><span class="p">]],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">test_df_y_last</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">dt</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">forecast_horizon</span><span class="p">)])</span>
            <span class="n">new_row</span> <span class="o">=</span> <span class="n">new_row</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">test_df_X_updated</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">freq</span><span class="p">)</span>

            <span class="n">model_fitted</span> <span class="o">=</span> <span class="n">model_fitted</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">new_row</span><span class="p">)</span>
            <span class="n">test_df_y_hat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">model_fitted</span><span class="o">.</span><span class="n">forecast</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="n">n_timestep_forecast_horizon</span><span class="p">)</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="c1"># to update based on the forecast horizon</span>


    <span class="c1"># test_df_y_hat = m06_lr.predict(test_df_X)</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m5_sarima.train_model_m5_sarima" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m5_sarima</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m5_sarima.train_model_m5_sarima" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a linear model for point forecasting. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon (int) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast horizon in mins</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m5_sarima.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m5_sarima</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a linear model for point forecasting. </span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>
<span class="sd">        forecast_horizon (int) : forecast horizon in mins</span>


<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;p&#39;</span><span class="p">]</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">]</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">]</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;P&#39;</span><span class="p">]</span>
    <span class="n">D</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;D&#39;</span><span class="p">]</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;Q&#39;</span><span class="p">]</span>
    <span class="n">seasonal_period_days</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;seasonal_period_days&#39;</span><span class="p">]</span>


    <span class="c1"># UPDATE train_df_y to exclude all rows after a sudden jump in the timestep</span>
    <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">remove_jump_df</span><span class="p">(</span><span class="n">train_df_y</span><span class="p">)</span>

    <span class="c1"># TRAIN MODEL</span>
    <span class="c1"># Calculate the frequency of the timesteps using the first and second index values</span>
    <span class="n">timestep_frequency</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seasonal_period_days</span> <span class="o">*</span> <span class="mi">24</span> <span class="o">*</span> <span class="mi">60</span> <span class="o">/</span> <span class="p">(</span><span class="n">timestep_frequency</span><span class="o">.</span><span class="n">seconds</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>
    <span class="n">inferred_frequency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">inferred_frequency</span><span class="p">)</span>

    <span class="c1"># INTRODUCE GAP BETWEEN TRAIN AND TEST SET TO AVOID DATA LEAKAGE</span>
    <span class="n">n_timestep_forecast_horizon</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">forecast_horizon</span> <span class="o">/</span> <span class="p">(</span><span class="n">timestep_frequency</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">n_timestep_forecast_horizon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">n_timestep_forecast_horizon</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="c1"># Assuming train_df_y_updated is your dataframe and &#39;y&#39; is the column with the training series</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>

    <span class="c1"># Build and fit the state-space ARIMA model</span>
    <span class="n">model_fitted</span> <span class="o">=</span> <span class="n">SARIMAX</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">d</span><span class="p">,</span> <span class="n">q</span><span class="p">),</span> <span class="n">seasonal_order</span> <span class="o">=</span> <span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">D</span><span class="p">,</span> <span class="n">Q</span><span class="p">,</span> <span class="n">s</span><span class="p">),</span> <span class="n">freq</span><span class="o">=</span><span class="n">inferred_frequency</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model_fitted&quot;</span><span class="p">:</span> <span class="n">model_fitted</span><span class="p">}</span>


    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m6_lr"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m6_lr.produce_forecast_m6_lr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m6_lr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m6_lr.produce_forecast_m6_lr" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m6_lr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m6_lr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fs_lr</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;feature_selector&#39;</span><span class="p">]</span>
    <span class="n">m06_lr</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;regression_model&#39;</span><span class="p">]</span>

    <span class="c1"># SELECT K BEST FEATURES</span>
    <span class="n">train_df_X</span> <span class="o">=</span> <span class="n">fs_lr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">test_df_X</span> <span class="o">=</span> <span class="n">fs_lr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">test_df_X</span><span class="p">)</span>

    <span class="c1"># PRODUCE FORECAST</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">m06_lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">m06_lr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_df_X</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m6_lr.train_model_m6_lr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m6_lr</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m6_lr.train_model_m6_lr" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a linear model for point forecasting. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (dictionary) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m6_lr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m6_lr</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a linear model for point forecasting. </span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>


<span class="sd">    Returns:</span>
<span class="sd">        model (dictionary) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="n">num_feature</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;num_features&#39;</span><span class="p">])</span>

    <span class="c1"># FEATURE SELECTOR</span>
    <span class="k">def</span> <span class="nf">select_features</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">num_feature</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&#39;&#39;&#39; Make model to select K best feature. </span>

<span class="sd">        Args:</span>
<span class="sd">            train_df_X (df) : features matrix for training</span>
<span class="sd">            train_df_y (df) : target matrix for training</span>

<span class="sd">        Returns:</span>
<span class="sd">            fs_lr (model) : feature selector</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="n">train_df_y</span> <span class="o">=</span> <span class="n">train_df_y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        <span class="n">fs_lr</span> <span class="o">=</span> <span class="n">SelectKBest</span><span class="p">(</span><span class="n">f_regression</span><span class="p">,</span> <span class="n">k</span> <span class="o">=</span> <span class="n">num_feature</span><span class="p">)</span>
        <span class="n">fs_lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">fs_lr</span>

    <span class="n">fs_lr</span> <span class="o">=</span> <span class="n">select_features</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">num_feature</span><span class="p">)</span>

    <span class="c1">#TRAIN MODEL</span>
    <span class="n">train_df_X</span> <span class="o">=</span> <span class="n">fs_lr</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">m06_lr</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span>
    <span class="n">m06_lr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;feature_selector&quot;</span><span class="p">:</span> <span class="n">fs_lr</span><span class="p">,</span> <span class="s2">&quot;regression_model&quot;</span><span class="p">:</span> <span class="n">m06_lr</span><span class="p">}</span>    

    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m7_ann"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m7_ann.produce_forecast_m7_ann" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m7_ann</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m7_ann.produce_forecast_m7_ann" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m7_ann.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m7_ann</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># UNPACK MODEL</span>
    <span class="n">model_ann</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;model_ann&quot;</span><span class="p">]</span>

    <span class="c1"># PREPARE FORMAT</span>
    <span class="n">train_df_X_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_df_X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">test_df_X_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">test_df_X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># PRODUCE FORECAST</span>
    <span class="c1"># Switch model to evaluation mode for inference</span>
    <span class="n">model_ann</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="c1"># TRAIN SET FORECAST</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>  <span class="c1"># Disable gradient calculation to save memory</span>
        <span class="n">train_df_y_hat_tensor</span> <span class="o">=</span> <span class="n">model_ann</span><span class="p">(</span><span class="n">train_df_X_tensor</span><span class="p">)</span>

    <span class="c1"># TEST SET FORECAST</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>  <span class="c1"># Disable gradient calculation to save memory</span>
        <span class="n">test_df_y_hat_tensor</span> <span class="o">=</span> <span class="n">model_ann</span><span class="p">(</span><span class="n">test_df_X_tensor</span><span class="p">)</span>

    <span class="c1"># Create DataFrames of result</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_df_y_hat_tensor</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">train_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">])</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_df_y_hat_tensor</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m7_ann.train_model_m7_ann" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m7_ann</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m7_ann.train_model_m7_ann" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a linear model for point forecasting. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m7_ann.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m7_ann</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a linear model for point forecasting. </span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>


<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>

    <span class="c1"># Set random seed for reproducibility</span>
    <span class="k">def</span> <span class="nf">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">):</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PYTHONHASHSEED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">deterministic</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">])</span>

    <span class="n">hidden_size</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;hidden_size&#39;</span><span class="p">]</span>
    <span class="n">activation_function</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;activation_function&#39;</span><span class="p">]</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">]</span>
    <span class="c1"># learning_rate = 0.001</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">]</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;epochs&#39;</span><span class="p">]</span>

    <span class="c1"># Use proper format for X and y</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_df_X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_df_y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 

    <span class="c1"># Define the ANN model</span>
    <span class="k">class</span> <span class="nc">ANNModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">ANNModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">relu</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()</span>  <span class="c1"># Activation function</span>

        <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc1</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">activation_function</span> <span class="o">==</span> <span class="s1">&#39;relu&#39;</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">activation_function</span> <span class="o">==</span> <span class="s1">&#39;sigmoid&#39;</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc2</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x</span>

    <span class="c1"># Model initialization</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">output_size</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="n">model_ann</span> <span class="o">=</span> <span class="n">ANNModel</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;adam&#39;</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model_ann</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;sgd&#39;</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model_ann</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Solver not found&#39;</span><span class="p">)</span>

    <span class="c1"># Loss function</span>
    <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>  <span class="c1"># Mean Squared Error loss for regression</span>

    <span class="c1">#TRAIN MODEL</span>
    <span class="c1"># Training loop</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="n">model_ann</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

        <span class="c1"># Forward pass</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_ann</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># Backward pass</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

        <span class="c1"># Update weights</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">], Loss: </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model_ann&quot;</span><span class="p">:</span> <span class="n">model_ann</span><span class="p">}</span>


    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m8_dnn"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m8_dnn.produce_forecast_m8_dnn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m8_dnn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m8_dnn.produce_forecast_m8_dnn" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (DataFrame) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (DataFrame) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m8_dnn.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m8_dnn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dict): all parameters of the trained model</span>
<span class="sd">        train_df_X (DataFrame): predictors of train set</span>
<span class="sd">        test_df_X (DataFrame): predictors of test set</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (DataFrame) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (DataFrame) : forecast result at test set</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># UNPACK MODEL</span>
    <span class="n">model_dnn</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;model_dnn&quot;</span><span class="p">]</span>

    <span class="c1"># PREPARE FORMAT</span>
    <span class="n">train_df_X_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_df_X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">test_df_X_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">test_df_X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># PRODUCE FORECAST</span>
    <span class="c1"># Switch model to evaluation mode for inference</span>
    <span class="n">model_dnn</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="c1"># TRAIN SET FORECAST</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>  <span class="c1"># Disable gradient calculation to save memory</span>
        <span class="n">train_df_y_hat_tensor</span> <span class="o">=</span> <span class="n">model_dnn</span><span class="p">(</span><span class="n">train_df_X_tensor</span><span class="p">)</span>

    <span class="c1"># TEST SET FORECAST</span>
    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>  <span class="c1"># Disable gradient calculation to save memory</span>
        <span class="n">test_df_y_hat_tensor</span> <span class="o">=</span> <span class="n">model_dnn</span><span class="p">(</span><span class="n">test_df_X_tensor</span><span class="p">)</span>

    <span class="c1"># Create DataFrames of result</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">train_df_y_hat_tensor</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">train_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">])</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_df_y_hat_tensor</span><span class="o">.</span><span class="n">numpy</span><span class="p">(),</span> <span class="n">index</span><span class="o">=</span><span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m8_dnn.train_model_m8_dnn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m8_dnn</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m8_dnn.train_model_m8_dnn" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a linear model for point forecasting. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (dict) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (DataFrame) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (DataFrame) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (dict) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m8_dnn.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m8_dnn</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a linear model for point forecasting. </span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (dict) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (DataFrame) : features matrix for training</span>
<span class="sd">        train_df_y (DataFrame) : target matrix for training</span>

<span class="sd">    Returns:</span>
<span class="sd">        model (dict) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># UNPACK HYPERPARAMETER</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>  <span class="c1"># Set seed for PyTorch</span>

    <span class="n">n_hidden</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;n_hidden&#39;</span><span class="p">]</span>
    <span class="n">hidden_size</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;hidden_size&#39;</span><span class="p">]</span>
    <span class="n">activation_function</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;activation_function&#39;</span><span class="p">]</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">]</span>
    <span class="n">solver</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;solver&#39;</span><span class="p">]</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;epochs&#39;</span><span class="p">]</span>

    <span class="c1"># Use proper format for X and y</span>
    <span class="n">X</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_df_X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_df_y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> 

    <span class="c1"># Define the DNN model</span>
    <span class="k">class</span> <span class="nc">DNNModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">,</span> <span class="n">activation_function</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">DNNModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">activation_function</span> <span class="o">=</span> <span class="n">activation_function</span>

            <span class="c1"># Input layer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">))</span>

            <span class="c1"># Hidden layers</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_hidden</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">))</span>

            <span class="c1"># Output layer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">layer</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>  <span class="c1"># Iterate through hidden layers</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">layer</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation_function</span> <span class="o">==</span> <span class="s1">&#39;relu&#39;</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">()(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation_function</span> <span class="o">==</span> <span class="s1">&#39;sigmoid&#39;</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sigmoid</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">activation_function</span> <span class="o">==</span> <span class="s1">&#39;tanh&#39;</span><span class="p">:</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tanh</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="c1"># Apply the output layer without activation function</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">layers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">](</span><span class="n">x</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">x</span>

    <span class="c1"># Model initialization</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">output_size</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">model_dnn</span> <span class="o">=</span> <span class="n">DNNModel</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">n_hidden</span><span class="p">,</span> <span class="n">activation_function</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;adam&#39;</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model_dnn</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">solver</span> <span class="o">==</span> <span class="s1">&#39;sgd&#39;</span><span class="p">:</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">SGD</span><span class="p">(</span><span class="n">model_dnn</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Solver not found&#39;</span><span class="p">)</span>

    <span class="c1"># Loss function</span>
    <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>  <span class="c1"># Mean Squared Error loss for regression</span>

    <span class="c1"># TRAIN MODEL</span>
    <span class="c1"># Training loop</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="n">model_dnn</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>

        <span class="c1"># Forward pass</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model_dnn</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># Backward pass</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>

        <span class="c1"># Update weights</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">epoch</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">], Loss: </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;model_dnn&quot;</span><span class="p">:</span> <span class="n">model_dnn</span><span class="p">}</span>

    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m9_rt"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m9_rt.produce_forecast_m9_rt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m9_rt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m9_rt.produce_forecast_m9_rt" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m9_rt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m9_rt</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># UNPACK MODEL</span>
    <span class="n">regressor</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;rt&#39;</span><span class="p">]</span>

    <span class="c1"># PRODUCE FORECAST</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">train_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">])</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">regressor</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_df_X</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">])</span>

    <span class="c1"># print(&#39;I am here after training the model&#39;)</span>
    <span class="c1"># print(&#39;train_df_y_hat&#39;, train_df_y_hat)</span>
    <span class="c1"># print(&#39;test_df_y_hat&#39;, test_df_y_hat)</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m9_rt.train_model_m9_rt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m9_rt</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m9_rt.train_model_m9_rt" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a regression tree model for point forecasting. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m9_rt.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m9_rt</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a regression tree model for point forecasting. </span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>


<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">]</span>
    <span class="n">min_samples_split</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;min_samples_split&#39;</span><span class="p">]</span>
    <span class="n">min_samples_leaf</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">]</span>
    <span class="n">max_features</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;max_features&#39;</span><span class="p">]</span>

    <span class="c1">#TRAIN MODEL</span>
    <span class="c1"># Initialize the regression tree model with important hyperparameters</span>
    <span class="n">regressor</span> <span class="o">=</span> <span class="n">DecisionTreeRegressor</span><span class="p">(</span>
        <span class="n">criterion</span><span class="o">=</span><span class="s1">&#39;squared_error&#39;</span><span class="p">,</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>
        <span class="n">min_samples_split</span> <span class="o">=</span> <span class="n">min_samples_split</span><span class="p">,</span>
        <span class="n">min_samples_leaf</span> <span class="o">=</span> <span class="n">min_samples_leaf</span><span class="p">,</span>
        <span class="n">max_features</span> <span class="o">=</span> <span class="n">max_features</span><span class="p">,</span>
        <span class="n">random_state</span> <span class="o">=</span> <span class="n">seed</span>
    <span class="p">)</span>

    <span class="c1"># Train the model</span>
    <span class="n">regressor</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rt&quot;</span><span class="p">:</span> <span class="n">regressor</span><span class="p">}</span>

    <span class="c1"># print(&#39;I am here after training the model&#39;)</span>

    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m10_rf"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m10_rf.produce_forecast_m10_rf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m10_rf</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m10_rf.produce_forecast_m10_rf" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m10_rf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m10_rf</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># UNPACK MODEL</span>
    <span class="n">rf</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;rf&#39;</span><span class="p">]</span>

    <span class="c1"># PRODUCE FORECAST</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">train_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">])</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">rf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_df_X</span><span class="p">),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m10_rf.train_model_m10_rf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m10_rf</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m10_rf.train_model_m10_rf" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a random forest model for point forecasting. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m10_rf.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m10_rf</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a random forest model for point forecasting. </span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>


<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">])</span>
    <span class="n">n_estimators</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;n_estimators&#39;</span><span class="p">])</span>
    <span class="n">max_depth</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;max_depth&#39;</span><span class="p">])</span>
    <span class="n">min_samples_split</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;min_samples_split&#39;</span><span class="p">])</span>
    <span class="n">min_samples_leaf</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;min_samples_leaf&#39;</span><span class="p">])</span>


    <span class="c1">#TRAIN MODEL</span>
    <span class="n">rf</span> <span class="o">=</span> <span class="n">RandomForestRegressor</span><span class="p">(</span>
        <span class="n">n_estimators</span><span class="o">=</span><span class="n">n_estimators</span><span class="p">,</span>       <span class="c1"># number of trees</span>
        <span class="n">max_depth</span><span class="o">=</span><span class="n">max_depth</span><span class="p">,</span>           <span class="c1"># maximum depth of a tree</span>
        <span class="n">min_samples_split</span><span class="o">=</span><span class="n">min_samples_split</span><span class="p">,</span>    <span class="c1"># min samples to split a node</span>
        <span class="n">min_samples_leaf</span><span class="o">=</span><span class="n">min_samples_leaf</span><span class="p">,</span>     <span class="c1"># min samples in a leaf</span>
        <span class="n">random_state</span><span class="o">=</span><span class="n">seed</span>
    <span class="p">)</span>

    <span class="n">rf</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span> <span class="c1"># fit the model to the training data</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rf&quot;</span><span class="p">:</span> <span class="n">rf</span><span class="p">}</span>


    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m11_svr"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m11_svr.produce_forecast_m11_svr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m11_svr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m11_svr.produce_forecast_m11_svr" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m11_svr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m11_svr</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">svr</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;svr&#39;</span><span class="p">]</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">svr</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_df_X</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m11_svr.train_model_m11_svr" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m11_svr</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m11_svr.train_model_m11_svr" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a linear model for point forecasting. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m11_svr.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m11_svr</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a linear model for point forecasting. </span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>


<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVR</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">]</span> <span class="c1">#seem we can&#39;t use this using sklearn</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;kernel&#39;</span><span class="p">]</span>
    <span class="n">C</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;C&#39;</span><span class="p">]</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;gamma&#39;</span><span class="p">]</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;epsilon&#39;</span><span class="p">]</span>

    <span class="c1">#TRAIN MODEL</span>
    <span class="n">train_df_y</span> <span class="o">=</span> <span class="n">train_df_y</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>  <span class="c1"># Flatten the target array if necessary</span>
    <span class="n">svr</span> <span class="o">=</span> <span class="n">SVR</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="n">kernel</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">C</span><span class="p">,</span> <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="n">epsilon</span><span class="p">)</span>
    <span class="n">svr</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;svr&quot;</span><span class="p">:</span> <span class="n">svr</span><span class="p">}</span>


    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m12_rnn"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m12_rnn.produce_forecast_m12_rnn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m12_rnn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m12_rnn.produce_forecast_m12_rnn" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained RNN model</p>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m12_rnn.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m12_rnn</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained RNN model&quot;&quot;&quot;</span>

    <span class="c1"># UNPACK MODEL</span>
    <span class="n">rnn</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;rnn&#39;</span><span class="p">]</span>
    <span class="n">hyperparameter</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;hyperparameter&#39;</span><span class="p">]</span>

    <span class="c1"># UNPACK HYPERPARAMETER</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;input_size&#39;</span><span class="p">])</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;batch_size&#39;</span><span class="p">])</span>

    <span class="c1"># PRODUCE FORECAST</span>
    <span class="k">def</span> <span class="nf">produce_forecast</span><span class="p">(</span><span class="n">rnn</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X_lags</span><span class="p">,</span> <span class="n">X_exog</span> <span class="o">=</span> <span class="n">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_lags</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">X_exog_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_exog</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="n">total_lag_features</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">sequence_length</span> <span class="o">=</span> <span class="n">total_lag_features</span> <span class="o">//</span> <span class="n">input_size</span>
        <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">,</span> <span class="n">input_size</span><span class="p">)</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_lags_tensor</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
            <span class="n">batch_X_lags</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span>
            <span class="n">batch_X_exog</span> <span class="o">=</span> <span class="n">X_exog_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span>

            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="n">batch_pred</span> <span class="o">=</span> <span class="n">rnn</span><span class="p">(</span><span class="n">batch_X_lags</span><span class="p">,</span> <span class="n">batch_X_exog</span><span class="p">)</span>

            <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_pred</span><span class="p">)</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">predictions</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast</span><span class="p">(</span><span class="n">rnn</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast</span><span class="p">(</span><span class="n">rnn</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m12_rnn.separate_lag_and_exogenous_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">,</span> <span class="n">target_column</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">lag_prefix</span><span class="o">=</span><span class="s1">&#39;y_lag&#39;</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m12_rnn.separate_lag_and_exogenous_features" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>This function separates the lag features and exogenous variables from the training dataframe.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataframe containing both lag features and exogenous variables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_column</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the target column (e.g., 'y').</p>
              </div>
            </td>
            <td>
                  <code>&#39;y&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lag_prefix</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prefix used for lag columns (e.g., 'y_lag').</p>
              </div>
            </td>
            <td>
                  <code>&#39;y_lag&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>X_lags</code></td>            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing only the lag features.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>X_exog</code></td>            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing only the exogenous variables.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m12_rnn.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">,</span> <span class="n">target_column</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">lag_prefix</span><span class="o">=</span><span class="s1">&#39;y_lag&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function separates the lag features and exogenous variables from the training dataframe.</span>

<span class="sd">    Args:</span>
<span class="sd">        train_df_X (pd.DataFrame): The dataframe containing both lag features and exogenous variables.</span>
<span class="sd">        target_column (str): The name of the target column (e.g., &#39;y&#39;).</span>
<span class="sd">        lag_prefix (str): The prefix used for lag columns (e.g., &#39;y_lag&#39;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        X_lags (pd.DataFrame): DataFrame containing only the lag features.</span>
<span class="sd">        X_exog (pd.DataFrame): DataFrame containing only the exogenous variables.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Identify lag features (columns that start with &#39;y_lag&#39;)</span>
    <span class="n">lag_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">train_df_X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">lag_prefix</span><span class="p">)]</span>

    <span class="c1"># Identify exogenous variables (everything except the target and lag features)</span>
    <span class="n">exog_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">train_df_X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">target_column</span><span class="p">]</span> <span class="o">+</span> <span class="n">lag_features</span><span class="p">]</span>

    <span class="c1"># Create dataframes for lag features and exogenous features</span>
    <span class="n">X_lags</span> <span class="o">=</span> <span class="n">train_df_X</span><span class="p">[</span><span class="n">lag_features</span><span class="p">]</span>
    <span class="n">X_exog</span> <span class="o">=</span> <span class="n">train_df_X</span><span class="p">[</span><span class="n">exog_features</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">X_lags</span><span class="p">,</span> <span class="n">X_exog</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m12_rnn.train_model_m12_rnn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m12_rnn</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m12_rnn.train_model_m12_rnn" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test an RNN model for point forecasting. 
Essentially we use the RNN block to learn the temporal patterns of the time series, 
and then use a fully connected layer to learn the relationship between the lag features.
We take the last hidden state of the RNN as the output, and concatenate it with the exogenous features 
(like calendar) to make the final prediction using a fully connected layer.</p>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m12_rnn.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m12_rnn</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test an RNN model for point forecasting. </span>
<span class="sd">    Essentially we use the RNN block to learn the temporal patterns of the time series, </span>
<span class="sd">    and then use a fully connected layer to learn the relationship between the lag features.</span>
<span class="sd">    We take the last hidden state of the RNN as the output, and concatenate it with the exogenous features </span>
<span class="sd">    (like calendar) to make the final prediction using a fully connected layer.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># UNPACK HYPERPARAMETER</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">])</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;input_size&#39;</span><span class="p">])</span>
    <span class="n">hidden_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;hidden_size&#39;</span><span class="p">])</span>
    <span class="n">num_layers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;num_layers&#39;</span><span class="p">])</span>
    <span class="n">output_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;output_size&#39;</span><span class="p">])</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;batch_size&#39;</span><span class="p">])</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;epochs&#39;</span><span class="p">])</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">]</span>

    <span class="c1"># DEFINE MODEL AND TRAINING FUNCTION</span>
    <span class="k">class</span> <span class="nc">RNNModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">exog_size</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">RNNModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

            <span class="c1"># Define the RNN layer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">RNN</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Define the Fully Connected (FC) layer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span> <span class="o">+</span> <span class="n">exog_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">exogenous_data</span><span class="p">):</span>
            <span class="c1"># Pass the input through the RNN</span>
            <span class="n">out</span><span class="p">,</span> <span class="n">h_n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">rnn</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="c1"># Get the last timestep hidden state</span>
            <span class="n">last_hidden_state</span> <span class="o">=</span> <span class="n">out</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># Shape: (batch_size, hidden_size)</span>

            <span class="c1"># Concatenate hidden state with exogenous vars</span>
            <span class="n">combined_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">last_hidden_state</span><span class="p">,</span> <span class="n">exogenous_data</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

            <span class="c1"># Pass through FC</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">combined_input</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">train_rnn_with_minibatches</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
        <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
            <span class="n">batch_no</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">X_lags_batch</span><span class="p">,</span> <span class="n">X_exog_batch</span><span class="p">,</span> <span class="n">y_batch</span> <span class="ow">in</span> <span class="n">train_loader</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">] and batch [</span><span class="si">{</span><span class="n">batch_no</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                <span class="n">batch_no</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="c1"># Forward pass</span>
                <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_lags_batch</span><span class="p">,</span> <span class="n">X_exog_batch</span><span class="p">)</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">y_batch</span><span class="p">)</span>

                <span class="c1"># Backward pass</span>
                <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
                <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">epoch_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">], Loss: </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, time taken: </span><span class="si">{</span><span class="n">epoch_time</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">):</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PYTHONHASHSEED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="c1"># PREPARE TRAIN DATA</span>
    <span class="n">X_lags</span><span class="p">,</span> <span class="n">X_exog</span> <span class="o">=</span> <span class="n">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_lags</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">X_exog_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_exog</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">y_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_df_y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">total_lag_features</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sequence_length</span> <span class="o">=</span> <span class="n">total_lag_features</span> <span class="o">//</span> <span class="n">input_size</span>
    <span class="n">exog_size</span> <span class="o">=</span> <span class="n">X_exog_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="c1"># Reshape to 3D</span>
    <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">,</span> <span class="n">input_size</span><span class="p">)</span>

    <span class="c1"># INITIALIZE MODEL + DATALOADER</span>
    <span class="n">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">rnn</span> <span class="o">=</span> <span class="n">RNNModel</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">exog_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
    <span class="n">train_data</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">X_lags_tensor</span><span class="p">,</span> <span class="n">X_exog_tensor</span><span class="p">,</span> <span class="n">y_tensor</span><span class="p">)</span>
    <span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># TRAIN MODEL</span>
    <span class="n">train_rnn_with_minibatches</span><span class="p">(</span><span class="n">rnn</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;rnn&quot;</span><span class="p">:</span> <span class="n">rnn</span><span class="p">,</span> <span class="s1">&#39;hyperparameter&#39;</span><span class="p">:</span> <span class="n">hyperparameter</span><span class="p">,</span> <span class="s2">&quot;train_df_X&quot;</span><span class="p">:</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="s2">&quot;train_df_y&quot;</span><span class="p">:</span> <span class="n">train_df_y</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m13_lstm"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m13_lstm.produce_forecast_m13_lstm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m13_lstm</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m13_lstm.produce_forecast_m13_lstm" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m13_lstm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m13_lstm</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># UNPACK MODEL</span>
    <span class="n">lstm</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;lstm&#39;</span><span class="p">]</span>
    <span class="n">hyperparameter</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;hyperparameter&#39;</span><span class="p">]</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">])</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;input_size&#39;</span><span class="p">])</span> <span class="c1">#this is one since we only use lag features to be fed into the LSTM. The exogenous features like calenndar are fed to the fully connected layer, together with the last hidden state of LSTM.</span>
    <span class="n">hidden_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;hidden_size&#39;</span><span class="p">])</span> <span class="c1">#this is the size of hidden state, and we aim to use many to one architecture. Meaning we only take the last hidden state as output, and fed into the fully connected layer.</span>
    <span class="n">num_layers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;num_layers&#39;</span><span class="p">])</span> <span class="c1"># we use 1 by default to make it simple. </span>
    <span class="n">output_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;output_size&#39;</span><span class="p">])</span> <span class="c1">#this is one since we only predict one value.</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;batch_size&#39;</span><span class="p">])</span> <span class="c1">#using minibatch is important cuz if we train all samples at once, the memory is not enough.</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;epochs&#39;</span><span class="p">])</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">]</span>  <span class="c1"># No change for learning rate</span>

    <span class="c1"># PRODUCE FORECAST</span>
    <span class="k">def</span> <span class="nf">produce_forecast</span><span class="p">(</span><span class="n">lstm</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="c1"># Convert X into X_lag and X_exog</span>
        <span class="n">X_lags</span><span class="p">,</span> <span class="n">X_exog</span> <span class="o">=</span> <span class="n">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_lags</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># Shape: (batch_size, sequence_length, input_size)</span>
        <span class="n">X_exog_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_exog</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># Shape: (batch_size, exog_size)</span>
        <span class="c1"># y_tensor = torch.tensor(train_df_y.values, dtype=torch.float32).view(-1, 1) to be deleted.</span>

        <span class="n">total_lag_features</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Number of lag features (columns)</span>
        <span class="n">sequence_length</span> <span class="o">=</span> <span class="n">total_lag_features</span> <span class="o">//</span> <span class="n">input_size</span>
        <span class="n">exog_size</span> <span class="o">=</span> <span class="n">X_exog_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Number of exogenous features</span>

        <span class="c1"># Reshaping X_lags_tensor to 3D: (batch_size, sequence_length, input_size)</span>
        <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">,</span> <span class="n">input_size</span><span class="p">)</span>

        <span class="c1">#predictions = lstm(X_lags_tensor, X_exog_tensor) #this doesn&#39;t work because of the batch size is too big, not enough memory.</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_lags_tensor</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
            <span class="c1"># Get the current minibatch for both X_lags_tensor and X_exog_tensor</span>
            <span class="n">batch_X_lags</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span>
            <span class="n">batch_X_exog</span> <span class="o">=</span> <span class="n">X_exog_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span>

            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="c1"># Make predictions for the minibatch</span>
                <span class="n">batch_pred</span> <span class="o">=</span> <span class="n">lstm</span><span class="p">(</span><span class="n">batch_X_lags</span><span class="p">,</span> <span class="n">batch_X_exog</span><span class="p">)</span>

            <span class="c1"># Store the predictions for the current batch</span>
            <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_pred</span><span class="p">)</span>

        <span class="c1"># Concatenate all predictions to get the full result</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>


        <span class="k">return</span> <span class="n">predictions</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast</span><span class="p">(</span><span class="n">lstm</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast</span><span class="p">(</span><span class="n">lstm</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m13_lstm.separate_lag_and_exogenous_features" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">,</span> <span class="n">target_column</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">lag_prefix</span><span class="o">=</span><span class="s1">&#39;y_lag&#39;</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m13_lstm.separate_lag_and_exogenous_features" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>This function separates the lag features and exogenous variables from the training dataframe.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dataframe containing both lag features and exogenous variables.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_column</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the target column (e.g., 'y').</p>
              </div>
            </td>
            <td>
                  <code>&#39;y&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lag_prefix</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The prefix used for lag columns (e.g., 'y_lag').</p>
              </div>
            </td>
            <td>
                  <code>&#39;y_lag&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>X_lags</code></td>            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing only the lag features.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>X_exog</code></td>            <td>
                  <code><span title="pandas.DataFrame">DataFrame</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DataFrame containing only the exogenous variables.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m13_lstm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">,</span> <span class="n">target_column</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">lag_prefix</span><span class="o">=</span><span class="s1">&#39;y_lag&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    This function separates the lag features and exogenous variables from the training dataframe.</span>

<span class="sd">    Args:</span>
<span class="sd">        train_df_X (pd.DataFrame): The dataframe containing both lag features and exogenous variables.</span>
<span class="sd">        target_column (str): The name of the target column (e.g., &#39;y&#39;).</span>
<span class="sd">        lag_prefix (str): The prefix used for lag columns (e.g., &#39;y_lag&#39;).</span>

<span class="sd">    Returns:</span>
<span class="sd">        X_lags (pd.DataFrame): DataFrame containing only the lag features.</span>
<span class="sd">        X_exog (pd.DataFrame): DataFrame containing only the exogenous variables.</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># Identify lag features (columns that start with &#39;y_lag&#39;)</span>
    <span class="n">lag_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">train_df_X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">lag_prefix</span><span class="p">)]</span>

    <span class="c1"># Identify exogenous variables (everything except the target and lag features)</span>
    <span class="n">exog_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">train_df_X</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="n">target_column</span><span class="p">]</span> <span class="o">+</span> <span class="n">lag_features</span><span class="p">]</span>

    <span class="c1"># Create dataframes for lag features and exogenous features</span>
    <span class="n">X_lags</span> <span class="o">=</span> <span class="n">train_df_X</span><span class="p">[</span><span class="n">lag_features</span><span class="p">]</span>
    <span class="n">X_exog</span> <span class="o">=</span> <span class="n">train_df_X</span><span class="p">[</span><span class="n">exog_features</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">X_lags</span><span class="p">,</span> <span class="n">X_exog</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m13_lstm.train_model_m13_lstm" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m13_lstm</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m13_lstm.train_model_m13_lstm" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test an LSTM model for point forecasting. 
Essentially we use the LSTM block to learn the temporal patterns of the time series, and then use a fully connected layer to learn the relationship between the lag features.
We take the last hidden state of the LSTM as the output, and concatenate it with the exogenous features (like calendar) to make the final prediction using a fully connected layer.
Future imporvement maybe to improve the architecture of the fully connected layer after LSTM. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m13_lstm.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m13_lstm</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test an LSTM model for point forecasting. </span>
<span class="sd">    Essentially we use the LSTM block to learn the temporal patterns of the time series, and then use a fully connected layer to learn the relationship between the lag features.</span>
<span class="sd">    We take the last hidden state of the LSTM as the output, and concatenate it with the exogenous features (like calendar) to make the final prediction using a fully connected layer.</span>
<span class="sd">    Future imporvement maybe to improve the architecture of the fully connected layer after LSTM. </span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>


<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">])</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;input_size&#39;</span><span class="p">])</span> <span class="c1">#this is one since we only use lag features to be fed into the LSTM. The exogenous features like calenndar are fed to the fully connected layer, together with the last hidden state of LSTM.</span>
    <span class="n">hidden_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;hidden_size&#39;</span><span class="p">])</span> <span class="c1">#this is the size of hidden state, and we aim to use many to one architecture. Meaning we only take the last hidden state as output, and fed into the fully connected layer.</span>
    <span class="n">num_layers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;num_layers&#39;</span><span class="p">])</span> <span class="c1"># we use 1 by default to make it simple. </span>
    <span class="n">output_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;output_size&#39;</span><span class="p">])</span> <span class="c1">#this is one since we only predict one value.</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;batch_size&#39;</span><span class="p">])</span> <span class="c1">#using minibatch is important cuz if we train all samples at once, the memory is not enough.</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;epochs&#39;</span><span class="p">])</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">]</span>  <span class="c1"># No change for learning rate</span>


    <span class="c1">#DEFINE MODEL AND TRAINING FUNCTION</span>
    <span class="k">class</span> <span class="nc">LSTMModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">exog_size</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">LSTMModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

            <span class="c1"># Define the LSTM layer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">lstm</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">LSTM</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="c1"># Define the Fully Connected (FC) layer</span>
            <span class="c1"># The FC layer input size is the concatenation of LSTM output and exogenous variables</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span> <span class="o">+</span> <span class="n">exog_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>  <span class="c1"># exog_size is the number of exogenous features</span>

        <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">exogenous_data</span><span class="p">):</span>
            <span class="c1"># Pass the input through the LSTM</span>
            <span class="n">out</span><span class="p">,</span> <span class="p">(</span><span class="n">h_n</span><span class="p">,</span> <span class="n">c_n</span><span class="p">)</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">lstm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

            <span class="c1"># Get the last timestep hidden state (h3)</span>
            <span class="n">last_hidden_state</span> <span class="o">=</span> <span class="n">out</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>  <span class="c1"># Shape: (batch_size, hidden_size)</span>

            <span class="c1"># Concatenate the LSTM output (h3) with the exogenous variables (for timestep t+100)</span>
            <span class="n">combined_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">last_hidden_state</span><span class="p">,</span> <span class="n">exogenous_data</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Shape: (batch_size, hidden_size + exog_size)</span>

            <span class="c1"># Pass the combined input through the FC layer</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">combined_input</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">train_lstm_with_minibatches</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
        <span class="c1"># Define the loss function (Mean Squared Error)</span>
        <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>

        <span class="c1"># Define the optimizer (Adam)</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>  <span class="c1"># Set model to training mode</span>
            <span class="c1"># print(f&#39;I am here&#39;)</span>

            <span class="c1"># Iterate over mini-batches</span>
            <span class="n">batch_no</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">X_lags_batch</span><span class="p">,</span> <span class="n">X_exog_batch</span><span class="p">,</span> <span class="n">y_batch</span> <span class="ow">in</span> <span class="n">train_loader</span><span class="p">:</span>
                <span class="c1"># print(f&#39;I am here now&#39;)</span>
                <span class="c1"># Print the loss and time taken for this epoch</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">] and batch [</span><span class="si">{</span><span class="n">batch_no</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                <span class="n">batch_no</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="c1"># Forward pass</span>
                <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_lags_batch</span><span class="p">,</span> <span class="n">X_exog_batch</span><span class="p">)</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">y_batch</span><span class="p">)</span>

                <span class="c1"># Backward pass</span>
                <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>  <span class="c1"># Zero gradients from previous step</span>
                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>  <span class="c1"># Backpropagate the error</span>
                <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>  <span class="c1"># Update the model&#39;s weights</span>



            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">epoch_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">], Loss: </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, time taken: </span><span class="si">{</span><span class="n">epoch_time</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">):</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PYTHONHASHSEED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="c1"># PREPARE TRAIN DATA</span>
    <span class="c1"># SEPARATE LAG AND EXOGENOUS FEATURES</span>
    <span class="n">X_lags</span><span class="p">,</span> <span class="n">X_exog</span> <span class="o">=</span> <span class="n">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_lags</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># Shape: (batch_size, sequence_length, input_size)</span>
    <span class="n">X_exog_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_exog</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>  <span class="c1"># Shape: (batch_size, exog_size)</span>
    <span class="n">y_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_df_y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">total_lag_features</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Number of lag features (columns)</span>
    <span class="n">sequence_length</span> <span class="o">=</span> <span class="n">total_lag_features</span> <span class="o">//</span> <span class="n">input_size</span>
    <span class="n">exog_size</span> <span class="o">=</span> <span class="n">X_exog_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>  <span class="c1"># Number of exogenous features</span>

    <span class="c1"># Reshaping X_lags_tensor to 3D: (batch_size, sequence_length, input_size)</span>
    <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">,</span> <span class="n">input_size</span><span class="p">)</span>


    <span class="c1"># INITIALIZE MODEL and MAKE TRAINING BATCHES</span>
    <span class="n">set_seed</span><span class="p">(</span><span class="n">seed</span> <span class="o">=</span> <span class="n">seed</span><span class="p">)</span> <span class="c1"># Set random seed for reproducibility</span>
    <span class="n">lstm</span> <span class="o">=</span> <span class="n">LSTMModel</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">exog_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
    <span class="c1"># Create a TensorDataset with your features and target</span>
    <span class="n">train_data</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">X_lags_tensor</span><span class="p">,</span> <span class="n">X_exog_tensor</span><span class="p">,</span> <span class="n">y_tensor</span><span class="p">)</span>
    <span class="c1"># Create a DataLoader to handle mini-batching</span>
    <span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># TRAIN MODEL</span>
    <span class="n">train_lstm_with_minibatches</span><span class="p">(</span><span class="n">lstm</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>


    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;lstm&quot;</span><span class="p">:</span> <span class="n">lstm</span><span class="p">,</span> <span class="s1">&#39;hyperparameter&#39;</span><span class="p">:</span> <span class="n">hyperparameter</span><span class="p">,</span> <span class="s2">&quot;train_df_X&quot;</span><span class="p">:</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="s2">&quot;train_df_y&quot;</span><span class="p">:</span> <span class="n">train_df_y</span><span class="p">}</span>


    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m14_gru"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m14_gru.produce_forecast_m14_gru" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m14_gru</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m14_gru.produce_forecast_m14_gru" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained GRU model
Args:
    model (dictionary): all parameters of the trained model
    train_df_X (df): predictors of train set
    test_df_X (df): predictors of test set</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m14_gru.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m14_gru</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained GRU model</span>
<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">gru</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;gru&#39;</span><span class="p">]</span>
    <span class="n">hyperparameter</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;hyperparameter&#39;</span><span class="p">]</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;input_size&#39;</span><span class="p">])</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;batch_size&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">produce_forecast</span><span class="p">(</span><span class="n">gru</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X_lags</span><span class="p">,</span> <span class="n">X_exog</span> <span class="o">=</span> <span class="n">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_lags</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">X_exog_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_exog</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="n">total_lag_features</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">sequence_length</span> <span class="o">=</span> <span class="n">total_lag_features</span> <span class="o">//</span> <span class="n">input_size</span>
        <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">,</span> <span class="n">input_size</span><span class="p">)</span>

        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_lags_tensor</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
            <span class="n">batch_X_lags</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span>
            <span class="n">batch_X_exog</span> <span class="o">=</span> <span class="n">X_exog_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span>
            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="n">batch_pred</span> <span class="o">=</span> <span class="n">gru</span><span class="p">(</span><span class="n">batch_X_lags</span><span class="p">,</span> <span class="n">batch_X_exog</span><span class="p">)</span>
            <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_pred</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast</span><span class="p">(</span><span class="n">gru</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast</span><span class="p">(</span><span class="n">gru</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m14_gru.train_model_m14_gru" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m14_gru</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m14_gru.train_model_m14_gru" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a GRU model for point forecasting. 
Uses GRU for temporal patterns, FC layer for lag+exogenous features.
Args:
    hyperparameter (df) : hyperparameter value of the model consisting of number of features
    train_df_X (df) : features matrix for training
    train_df_y (df) : target matrix for training</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m14_gru.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m14_gru</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a GRU model for point forecasting. </span>
<span class="sd">    Uses GRU for temporal patterns, FC layer for lag+exogenous features.</span>
<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>


<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># UNPACK HYPERPARAMETER</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">])</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;input_size&#39;</span><span class="p">])</span>
    <span class="n">hidden_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;hidden_size&#39;</span><span class="p">])</span>
    <span class="n">num_layers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;num_layers&#39;</span><span class="p">])</span>
    <span class="n">output_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;output_size&#39;</span><span class="p">])</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;batch_size&#39;</span><span class="p">])</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;epochs&#39;</span><span class="p">])</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">]</span>

    <span class="c1"># DEFINE MODEL</span>
    <span class="k">class</span> <span class="nc">GRUModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">exog_size</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">GRUModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gru</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">GRU</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span> <span class="o">+</span> <span class="n">exog_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">exogenous_data</span><span class="p">):</span>
            <span class="n">out</span><span class="p">,</span> <span class="n">h_n</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gru</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">last_hidden_state</span> <span class="o">=</span> <span class="n">out</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">combined_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">last_hidden_state</span><span class="p">,</span> <span class="n">exogenous_data</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">combined_input</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">train_gru_with_minibatches</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.001</span><span class="p">):</span>
        <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
            <span class="n">batch_no</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">X_lags_batch</span><span class="p">,</span> <span class="n">X_exog_batch</span><span class="p">,</span> <span class="n">y_batch</span> <span class="ow">in</span> <span class="n">train_loader</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">] and batch [</span><span class="si">{</span><span class="n">batch_no</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                <span class="n">batch_no</span> <span class="o">+=</span> <span class="mi">1</span>

                <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_lags_batch</span><span class="p">,</span> <span class="n">X_exog_batch</span><span class="p">)</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">y_batch</span><span class="p">)</span>

                <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
                <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">], Loss: </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, time taken: </span><span class="si">{</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">):</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PYTHONHASHSEED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="c1"># PREPARE TRAIN DATA</span>
    <span class="n">X_lags</span><span class="p">,</span> <span class="n">X_exog</span> <span class="o">=</span> <span class="n">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_lags</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">X_exog_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_exog</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">y_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_df_y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

    <span class="n">total_lag_features</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sequence_length</span> <span class="o">=</span> <span class="n">total_lag_features</span> <span class="o">//</span> <span class="n">input_size</span>
    <span class="n">exog_size</span> <span class="o">=</span> <span class="n">X_exog_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">,</span> <span class="n">input_size</span><span class="p">)</span>

    <span class="c1"># INITIALIZE MODEL + DATALOADER</span>
    <span class="n">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">gru</span> <span class="o">=</span> <span class="n">GRUModel</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">exog_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
    <span class="n">train_data</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">X_lags_tensor</span><span class="p">,</span> <span class="n">X_exog_tensor</span><span class="p">,</span> <span class="n">y_tensor</span><span class="p">)</span>
    <span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># TRAIN MODEL</span>
    <span class="n">train_gru_with_minibatches</span><span class="p">(</span><span class="n">gru</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;gru&quot;</span><span class="p">:</span> <span class="n">gru</span><span class="p">,</span> <span class="s1">&#39;hyperparameter&#39;</span><span class="p">:</span> <span class="n">hyperparameter</span><span class="p">,</span> <span class="s2">&quot;train_df_X&quot;</span><span class="p">:</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="s2">&quot;train_df_y&quot;</span><span class="p">:</span> <span class="n">train_df_y</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m15_transformer"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m15_transformer.produce_forecast_m15_transformer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m15_transformer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m15_transformer.produce_forecast_m15_transformer" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained Transformer model
Args:
    model (dictionary): all parameters of the trained model
    train_df_X (df): predictors of train set
    test_df_X (df): predictors of test set</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m15_transformer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m15_transformer</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained Transformer model</span>
<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">transformer</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;transformer&#39;</span><span class="p">]</span>
    <span class="n">hyperparameter</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;hyperparameter&#39;</span><span class="p">]</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;batch_size&#39;</span><span class="p">])</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;input_size&#39;</span><span class="p">])</span>

    <span class="k">def</span> <span class="nf">produce_forecast</span><span class="p">(</span><span class="n">transformer</span><span class="p">,</span> <span class="n">X</span><span class="p">):</span>
        <span class="n">X_lags</span><span class="p">,</span> <span class="n">X_exog</span> <span class="o">=</span> <span class="n">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>
        <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_lags</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">X_exog_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_exog</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">total_lag_features</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">sequence_length</span> <span class="o">=</span> <span class="n">total_lag_features</span> <span class="o">//</span> <span class="n">input_size</span>
        <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">,</span> <span class="n">input_size</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">X_lags_tensor</span><span class="p">),</span> <span class="n">batch_size</span><span class="p">):</span>
            <span class="n">batch_X_lags</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span>
            <span class="n">batch_X_exog</span> <span class="o">=</span> <span class="n">X_exog_tensor</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="n">batch_size</span><span class="p">]</span>
            <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
                <span class="n">batch_pred</span> <span class="o">=</span> <span class="n">transformer</span><span class="p">(</span><span class="n">batch_X_lags</span><span class="p">,</span> <span class="n">batch_X_exog</span><span class="p">)</span>
            <span class="n">predictions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_pred</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">dim</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast</span><span class="p">(</span><span class="n">transformer</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">produce_forecast</span><span class="p">(</span><span class="n">transformer</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m15_transformer.train_model_m15_transformer" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m15_transformer</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m15_transformer.train_model_m15_transformer" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a Transformer model for point forecasting. 
Uses Transformer for temporal patterns, FC layer for lag+exogenous features.
Args:
    hyperparameter (df) : hyperparameter value of the model consisting of number of features
    train_df_X (df) : features matrix for training
    train_df_y (df) : target matrix for training</p>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m15_transformer.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">  7</span>
<span class="normal">  8</span>
<span class="normal">  9</span>
<span class="normal"> 10</span>
<span class="normal"> 11</span>
<span class="normal"> 12</span>
<span class="normal"> 13</span>
<span class="normal"> 14</span>
<span class="normal"> 15</span>
<span class="normal"> 16</span>
<span class="normal"> 17</span>
<span class="normal"> 18</span>
<span class="normal"> 19</span>
<span class="normal"> 20</span>
<span class="normal"> 21</span>
<span class="normal"> 22</span>
<span class="normal"> 23</span>
<span class="normal"> 24</span>
<span class="normal"> 25</span>
<span class="normal"> 26</span>
<span class="normal"> 27</span>
<span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m15_transformer</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a Transformer model for point forecasting. </span>
<span class="sd">    Uses Transformer for temporal patterns, FC layer for lag+exogenous features.</span>
<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>

<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1"># UNPACK HYPERPARAMETER</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">])</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;input_size&#39;</span><span class="p">])</span>
    <span class="n">hidden_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;hidden_size&#39;</span><span class="p">])</span>
    <span class="n">num_layers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;num_layers&#39;</span><span class="p">])</span>
    <span class="n">output_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;output_size&#39;</span><span class="p">])</span>
    <span class="n">batch_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;batch_size&#39;</span><span class="p">])</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;epochs&#39;</span><span class="p">])</span>
    <span class="n">nhead</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;nhead&#39;</span><span class="p">])</span>
    <span class="n">learning_rate</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;learning_rate&#39;</span><span class="p">]</span>

    <span class="kn">import</span> <span class="nn">torch</span>
    <span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
    <span class="kn">import</span> <span class="nn">torch.optim</span> <span class="k">as</span> <span class="nn">optim</span>
    <span class="kn">import</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span><span class="o">,</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">time</span>
    <span class="kn">from</span> <span class="nn">torch.utils.data</span> <span class="kn">import</span> <span class="n">DataLoader</span><span class="p">,</span> <span class="n">TensorDataset</span>

    <span class="c1"># TRANSFORMER MODEL</span>
    <span class="k">class</span> <span class="nc">TransformerModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">exog_size</span><span class="p">,</span> <span class="n">output_size</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">TransformerModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
            <span class="c1"># Transformer embedding</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">)</span>
            <span class="n">encoder_layer</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TransformerEncoderLayer</span><span class="p">(</span>
                <span class="n">d_model</span><span class="o">=</span><span class="n">hidden_size</span><span class="p">,</span>
                <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span>
                <span class="n">dim_feedforward</span><span class="o">=</span><span class="n">hidden_size</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                <span class="n">batch_first</span><span class="o">=</span><span class="kc">True</span>
            <span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">transformer_encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TransformerEncoder</span><span class="p">(</span><span class="n">encoder_layer</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="n">num_layers</span><span class="p">)</span>
            <span class="c1"># Fully connected output layer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fc</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span> <span class="o">+</span> <span class="n">exog_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">exogenous_data</span><span class="p">):</span>
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">embedding</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> 
            <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">transformer_encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">last_hidden_state</span> <span class="o">=</span> <span class="n">x</span><span class="p">[:,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">combined_input</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">last_hidden_state</span><span class="p">,</span> <span class="n">exogenous_data</span><span class="p">),</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fc</span><span class="p">(</span><span class="n">combined_input</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>

    <span class="k">def</span> <span class="nf">train_transformer_with_minibatches</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">epochs</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">):</span>
        <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
        <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
            <span class="n">batch_no</span> <span class="o">=</span> <span class="mi">1</span>
            <span class="k">for</span> <span class="n">X_lags_batch</span><span class="p">,</span> <span class="n">X_exog_batch</span><span class="p">,</span> <span class="n">y_batch</span> <span class="ow">in</span> <span class="n">train_loader</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">] batch [</span><span class="si">{</span><span class="n">batch_no</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">train_loader</span><span class="p">)</span><span class="si">}</span><span class="s1">]&#39;</span><span class="p">)</span>
                <span class="n">batch_no</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">predictions</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_lags_batch</span><span class="p">,</span> <span class="n">X_exog_batch</span><span class="p">)</span>
                <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">predictions</span><span class="p">,</span> <span class="n">y_batch</span><span class="p">)</span>
                <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
                <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
                <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Epoch [</span><span class="si">{</span><span class="n">epoch</span><span class="o">+</span><span class="mi">1</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="n">epochs</span><span class="si">}</span><span class="s1">], Loss: </span><span class="si">{</span><span class="n">loss</span><span class="o">.</span><span class="n">item</span><span class="p">()</span><span class="si">:</span><span class="s1">.4f</span><span class="si">}</span><span class="s1">, time: </span><span class="si">{</span><span class="n">end_time</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">start_time</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="o">=</span><span class="n">seed</span><span class="p">):</span>
        <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
        <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;PYTHONHASHSEED&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>

    <span class="c1"># --- DATA PREP ---</span>
    <span class="n">X_lags</span><span class="p">,</span> <span class="n">X_exog</span> <span class="o">=</span> <span class="n">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_lags</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">X_exog_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">X_exog</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">y_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_df_y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">total_lag_features</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">sequence_length</span> <span class="o">=</span> <span class="n">total_lag_features</span> <span class="o">//</span> <span class="n">input_size</span>
    <span class="n">exog_size</span> <span class="o">=</span> <span class="n">X_exog_tensor</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">X_lags_tensor</span> <span class="o">=</span> <span class="n">X_lags_tensor</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">sequence_length</span><span class="p">,</span> <span class="n">input_size</span><span class="p">)</span>

    <span class="c1"># --- INIT MODEL AND DATALOADER ---</span>
    <span class="n">set_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">transformer</span> <span class="o">=</span> <span class="n">TransformerModel</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">,</span> <span class="n">exog_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">)</span>
    <span class="n">train_data</span> <span class="o">=</span> <span class="n">TensorDataset</span><span class="p">(</span><span class="n">X_lags_tensor</span><span class="p">,</span> <span class="n">X_exog_tensor</span><span class="p">,</span> <span class="n">y_tensor</span><span class="p">)</span>
    <span class="n">train_loader</span> <span class="o">=</span> <span class="n">DataLoader</span><span class="p">(</span><span class="n">train_data</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">train_transformer_with_minibatches</span><span class="p">(</span><span class="n">transformer</span><span class="p">,</span> <span class="n">train_loader</span><span class="p">,</span> <span class="n">epochs</span><span class="o">=</span><span class="n">epochs</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="n">learning_rate</span><span class="p">)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;transformer&quot;</span><span class="p">:</span> <span class="n">transformer</span><span class="p">,</span> <span class="s1">&#39;hyperparameter&#39;</span><span class="p">:</span> <span class="n">hyperparameter</span><span class="p">,</span> <span class="s2">&quot;train_df_X&quot;</span><span class="p">:</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="s2">&quot;train_df_y&quot;</span><span class="p">:</span> <span class="n">train_df_y</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m16_prophet"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m16_prophet.produce_forecast_m16_prophet" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m16_prophet</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m16_prophet.produce_forecast_m16_prophet" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast horizon for the model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m16_prophet.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m16_prophet</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>
<span class="sd">        train_df_y (df): target of train set</span>
<span class="sd">        forecast_horizon (int): forecast horizon for the model</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># UNPACK MODEL</span>
    <span class="n">prophet_model</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;prophet&#39;</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">]</span>
    <span class="n">hyperparameter</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s1">&#39;hyperparameter&#39;</span><span class="p">]</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="n">seasonality_prior_scale</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;seasonality_prior_scale&quot;</span><span class="p">]</span>
    <span class="n">seasonality_mode</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;seasonality_mode&quot;</span><span class="p">]</span>
    <span class="n">weekly_seasonality</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;weekly_seasonality&quot;</span><span class="p">]</span>
    <span class="n">daily_seasonality</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;daily_seasonality&quot;</span><span class="p">]</span>
    <span class="n">growth</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;growth&quot;</span><span class="p">]</span>

    <span class="c1"># Set up X_exog which is used for prediction</span>
    <span class="n">timestep_frequency</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">n_timestep_forecast_horizon</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">forecast_horizon</span> <span class="o">/</span> <span class="p">(</span><span class="n">timestep_frequency</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>

    <span class="n">train_df_X_updated</span> <span class="o">=</span> <span class="n">remove_jump_df</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">test_df_X_updated</span> <span class="o">=</span> <span class="n">remove_jump_df</span><span class="p">(</span><span class="n">test_df_X</span><span class="p">)</span>

    <span class="n">X_lags</span><span class="p">,</span> <span class="n">X_exog</span> <span class="o">=</span> <span class="n">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">train_df_X_updated</span><span class="p">)</span>

    <span class="n">X_exog</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">X_exog</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;datetime&#39;</span><span class="p">:</span> <span class="s1">&#39;ds&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Forecast train set</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">prophet_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_exog</span><span class="p">)</span>

    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">train_df_y_hat</span><span class="p">[[</span><span class="s1">&#39;ds&#39;</span><span class="p">,</span> <span class="s1">&#39;yhat&#39;</span><span class="p">]]</span>

    <span class="n">train_df_y_hat</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;ds&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">train_df_y_hat</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;datetime&#39;</span>

    <span class="c1"># Set up function to warm start the model for updating the fit</span>
    <span class="k">def</span> <span class="nf">warm_start_params</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Retrieve parameters from a trained model in the format used to initialize a new Stan model.</span>
<span class="sd">        Note that the new Stan model must have these same settings:</span>
<span class="sd">            n_changepoints, seasonality features, mcmc sampling</span>
<span class="sd">        for the retrieved parameters to be valid for the new model.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        m: A trained model of the Prophet class.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        A Dictionary containing retrieved parameters of m.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">res</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">pname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="s1">&#39;sigma_obs&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">mcmc_samples</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">pname</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">pname</span><span class="p">])</span>
        <span class="k">for</span> <span class="n">pname</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;delta&#39;</span><span class="p">,</span> <span class="s1">&#39;beta&#39;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">mcmc_samples</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">pname</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">res</span><span class="p">[</span><span class="n">pname</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="n">pname</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">res</span>

    <span class="c1"># PRODUCE FORECASTFOR TEST SET</span>

    <span class="c1"># REFIT THE MODEL AND PRODUCE NEW FORECAST FOR TEST SET</span>
    <span class="c1"># The model is refitted for 100 times only so there will be only 100 forecast results. </span>

    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">test_df_y_hat</span><span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>


    <span class="c1"># in the case of CV 10, which is when test df &lt; train df</span>
    <span class="c1"># don&#39;t compute the test forecast</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">train_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
    <span class="c1"># this is the case when we use CV10, where the test set is before the train set</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test set is before train set / CV 10, no test forecast can be made&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>

    <span class="n">_</span><span class="p">,</span> <span class="n">X_test</span> <span class="o">=</span> <span class="n">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">test_df_X</span><span class="p">)</span>
    <span class="n">X_test</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">X_test</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;datetime&#39;</span><span class="p">:</span> <span class="s1">&#39;ds&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">n_update</span> <span class="o">=</span> <span class="mi">100</span>
    <span class="n">n_timesteps_per_update</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">test_df_y_hat</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">n_update</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>

    <span class="c1"># TRANSFORM test_df_X to a series with only the last lag</span>
    <span class="n">horizon_timedelta</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">forecast_horizon</span><span class="p">)</span>
    <span class="n">last_observation</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;y_lag_</span><span class="si">{</span><span class="n">horizon_timedelta</span><span class="si">}</span><span class="s1">m&#39;</span>
    <span class="n">test_df_y_last</span> <span class="o">=</span> <span class="n">test_df_X</span><span class="p">[</span><span class="n">last_observation</span><span class="p">]</span>

    <span class="n">new_y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">test_df_y_last</span><span class="p">)</span>
    <span class="n">new_y</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="n">new_y</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span> <span class="s1">&#39;y&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">new_y</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;ds&#39;</span><span class="p">,</span> <span class="n">new_y</span><span class="o">.</span><span class="n">index</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">minutes</span><span class="o">=</span><span class="n">forecast_horizon</span><span class="p">))</span>
    <span class="n">new_y</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">new_y</span> <span class="o">=</span> <span class="n">new_y</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">X_exog_complete</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">X_exog</span><span class="p">,</span> <span class="n">X_test</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">X_exog_complete</span> <span class="o">=</span> <span class="n">X_exog_complete</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">new_y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">new_y</span><span class="p">,</span> <span class="n">X_exog_complete</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;ds&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_update</span><span class="p">):</span>
    <span class="c1"># for i in range(2): #for test only</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Processing i = &#39;</span><span class="p">,</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39; out of &#39;</span><span class="p">,</span> <span class="n">n_update</span><span class="p">),</span>
        <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">X_test_curr</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">1</span><span class="p">,:]</span>
            <span class="n">test_df_y_hat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">prophet_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_curr</span><span class="p">)[</span><span class="s1">&#39;yhat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">new_rows</span> <span class="o">=</span> <span class="n">new_y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">n_timesteps_per_update</span> <span class="p">:</span> <span class="n">i</span><span class="o">*</span><span class="n">n_timesteps_per_update</span><span class="p">,</span> <span class="p">:]</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">y</span><span class="p">,</span> <span class="n">new_rows</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

            <span class="n">current_params</span> <span class="o">=</span> <span class="n">warm_start_params</span><span class="p">(</span><span class="n">prophet_model</span><span class="p">)</span>

            <span class="n">prophet_model</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span>
                <span class="n">seasonality_prior_scale</span><span class="o">=</span><span class="n">seasonality_prior_scale</span><span class="p">,</span>  <span class="c1"># Example hyperparameter for seasonality strength</span>
                <span class="n">seasonality_mode</span><span class="o">=</span><span class="n">seasonality_mode</span><span class="p">,</span>  <span class="c1"># Use multiplicative seasonality</span>
                <span class="n">weekly_seasonality</span><span class="o">=</span><span class="n">weekly_seasonality</span><span class="p">,</span>  <span class="c1"># Enable weekly seasonality</span>
                <span class="n">daily_seasonality</span><span class="o">=</span><span class="n">daily_seasonality</span><span class="p">,</span>  <span class="c1"># Enable daily seasonality</span>
                <span class="n">growth</span><span class="o">=</span><span class="n">growth</span><span class="p">,</span>  <span class="c1"># Choose between &#39;linear&#39; or &#39;logistic&#39; growth</span>
            <span class="p">)</span>

            <span class="n">prophet_model</span> <span class="o">=</span> <span class="n">prophet_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">init</span><span class="o">=</span><span class="n">current_params</span><span class="p">)</span>  <span class="c1"># Adding the last day, warm-starting from the prev model</span>
            <span class="n">X_test_curr</span> <span class="o">=</span> <span class="n">X_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">n_timesteps_per_update</span> <span class="p">:</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">i</span><span class="o">*</span><span class="n">n_timesteps_per_update</span><span class="p">),:]</span>
            <span class="n">test_df_y_hat</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="o">*</span><span class="n">n_timesteps_per_update</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">prophet_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_curr</span><span class="p">)[</span><span class="s1">&#39;yhat&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m16_prophet.train_model_m16_prophet" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m16_prophet</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m16_prophet.train_model_m16_prophet" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train a prophet model for point forecasting. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>forecast_horizon (int) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>forecast horizon for the model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m16_prophet.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m16_prophet</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">,</span> <span class="n">forecast_horizon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train a prophet model for point forecasting. </span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>
<span class="sd">        forecast_horizon (int) : forecast horizon for the model</span>

<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;seed&quot;</span><span class="p">]</span>
    <span class="n">seasonality_prior_scale</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;seasonality_prior_scale&quot;</span><span class="p">]</span>
    <span class="n">seasonality_mode</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;seasonality_mode&quot;</span><span class="p">]</span>
    <span class="n">weekly_seasonality</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;weekly_seasonality&quot;</span><span class="p">]</span>
    <span class="n">daily_seasonality</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;daily_seasonality&quot;</span><span class="p">]</span>
    <span class="n">growth</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;growth&quot;</span><span class="p">]</span>


    <span class="c1"># UPDATE train_df to exclude all rows after a sudden jump in the timestep</span>
    <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">remove_jump_df</span><span class="p">(</span><span class="n">train_df_y</span><span class="p">)</span>
    <span class="n">train_df_X_updated</span> <span class="o">=</span> <span class="n">remove_jump_df</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>

    <span class="c1"># Calculate the frequency of the timesteps using the first and second index values</span>
    <span class="n">timestep_frequency</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">inferred_frequency</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">infer_freq</span><span class="p">(</span><span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">asfreq</span><span class="p">(</span><span class="n">inferred_frequency</span><span class="p">)</span> 

    <span class="c1"># INTRODUCE GAP BETWEEN TRAIN AND TEST SET TO AVOID DATA LEAKAGE</span>
    <span class="n">n_timestep_forecast_horizon</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">forecast_horizon</span> <span class="o">/</span> <span class="p">(</span><span class="n">timestep_frequency</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">/</span> <span class="mi">60</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">n_timestep_forecast_horizon</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">pass</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">train_df_y_updated</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">n_timestep_forecast_horizon</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>
        <span class="n">train_df_X_updated</span> <span class="o">=</span> <span class="n">train_df_X_updated</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">n_timestep_forecast_horizon</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)]</span>

    <span class="c1"># Assuming train_df_y_updated is your dataframe and &#39;y&#39; is the column with the training series</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">train_df_y_updated</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">X_lags</span><span class="p">,</span> <span class="n">X_exog</span> <span class="o">=</span> <span class="n">separate_lag_and_exogenous_features</span><span class="p">(</span><span class="n">train_df_X_updated</span><span class="p">)</span>

    <span class="c1">#Initialize the Prophet model with hyperparameters</span>
    <span class="n">prophet_model</span> <span class="o">=</span> <span class="n">Prophet</span><span class="p">(</span>
        <span class="n">seasonality_prior_scale</span><span class="o">=</span><span class="n">seasonality_prior_scale</span><span class="p">,</span>  <span class="c1"># Example hyperparameter for seasonality strength</span>
        <span class="n">seasonality_mode</span><span class="o">=</span><span class="n">seasonality_mode</span><span class="p">,</span>  <span class="c1"># Use multiplicative seasonality</span>
        <span class="n">weekly_seasonality</span><span class="o">=</span><span class="n">weekly_seasonality</span><span class="p">,</span>  <span class="c1"># Enable weekly seasonality</span>
        <span class="n">daily_seasonality</span><span class="o">=</span><span class="n">daily_seasonality</span><span class="p">,</span>  <span class="c1"># Enable daily seasonality</span>
        <span class="n">growth</span><span class="o">=</span><span class="n">growth</span>  <span class="c1"># Choose between &#39;linear&#39; or &#39;logistic&#39; growth</span>
        <span class="c1"># random_state =  seed,  # cannot set seed in prophet</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">X_exog</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">prophet_model</span><span class="o">.</span><span class="n">add_regressor</span><span class="p">(</span><span class="n">col</span><span class="p">)</span>

    <span class="c1"># Add exogenous features to the y DataFrame</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">X_exog</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>
    <span class="n">y</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">y</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;datetime&#39;</span><span class="p">:</span> <span class="s1">&#39;ds&#39;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Train model</span>
    <span class="n">prophet_model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;prophet&quot;</span><span class="p">:</span> <span class="n">prophet_model</span><span class="p">,</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span> <span class="s2">&quot;hyperparameter&quot;</span><span class="p">:</span> <span class="n">hyperparameter</span><span class="p">}</span>


    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m17_xgb"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m17_xgb.produce_forecast_m17_xgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m17_xgb</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m17_xgb.produce_forecast_m17_xgb" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained model</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model</code>
            </td>
            <td>
                  <code><span title="dictionary">dictionary</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>all parameters of the trained model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X</code>
            </td>
            <td>
                  <code><span title="df">df</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (df) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (df) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m17_xgb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m17_xgb</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create forecast at the train and test set using the trained model</span>

<span class="sd">    Args:</span>
<span class="sd">        model (dictionary): all parameters of the trained model</span>
<span class="sd">        train_df_X (df): predictors of train set</span>
<span class="sd">        test_df_X (df): predictors of test set</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (df) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (df) : forecast result at test set</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># UNPACK MODEL</span>
    <span class="n">xgb</span> <span class="o">=</span> <span class="n">model</span><span class="p">[</span><span class="s2">&quot;xgb&quot;</span><span class="p">]</span>

    <span class="c1"># PRODUCE FORECAST</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">)</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">xgb</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_df_X</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m17_xgb.train_model_m17_xgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m17_xgb</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m17_xgb.train_model_m17_xgb" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test a xgb model for point forecasting. </p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>hyperparameter value of the model consisting of number of features</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>features matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (df) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target matrix for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model (model) : trained model with all features</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m17_xgb.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m17_xgb</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39; Train and test a xgb model for point forecasting. </span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (df) : hyperparameter value of the model consisting of number of features</span>
<span class="sd">        train_df_X (df) : features matrix for training</span>
<span class="sd">        train_df_y (df) : target matrix for training</span>


<span class="sd">    Returns:</span>
<span class="sd">        model (model) : trained model with all features</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="c1">#UNPACK HYPERPARAMETER</span>
    <span class="n">xgb_seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;xgb_seed&quot;</span><span class="p">])</span>
    <span class="n">n_estimators</span><span class="o">=</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;n_estimators&quot;</span><span class="p">]</span>
    <span class="n">learning_rate</span><span class="o">=</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;learning_rate&quot;</span><span class="p">]</span>
    <span class="n">max_depth</span><span class="o">=</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;max_depth&quot;</span><span class="p">]</span>
    <span class="n">subsample</span><span class="o">=</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;subsample&quot;</span><span class="p">]</span>
    <span class="n">colsample_bytree</span><span class="o">=</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s2">&quot;colsample_bytree&quot;</span><span class="p">]</span>

    <span class="c1">#INITIALIZE AND TRAIN MODEL</span>
    <span class="n">xgb</span> <span class="o">=</span> <span class="n">XGBRegressor</span><span class="p">(</span><span class="n">n_estimators</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span> <span class="n">subsample</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">colsample_bytree</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="n">xgb_seed</span><span class="p">)</span>   
    <span class="n">xgb</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span>   

    <span class="c1"># PACK MODEL</span>
    <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;xgb&quot;</span><span class="p">:</span> <span class="n">xgb</span><span class="p">}</span>


    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.m18_nbeats"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m18_nbeats.produce_forecast_m18_nbeats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">produce_forecast_m18_nbeats</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m18_nbeats.produce_forecast_m18_nbeats" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Create forecast at the train and test set using the trained NBeats model.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>model </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>trained NBeats PyTorch model</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (DataFrame) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of train set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>test_df_X (DataFrame) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors of test set</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>train_df_y_hat (DataFrame) : forecast result at train set</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>test_df_y_hat (DataFrame) : forecast result at test set</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m18_nbeats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">produce_forecast_m18_nbeats</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">test_df_X</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Create forecast at the train and test set using the trained NBeats model.</span>

<span class="sd">    Args:</span>
<span class="sd">        model : trained NBeats PyTorch model</span>
<span class="sd">        train_df_X (DataFrame) : predictors of train set</span>
<span class="sd">        test_df_X (DataFrame) : predictors of test set</span>

<span class="sd">    Returns:</span>
<span class="sd">        train_df_y_hat (DataFrame) : forecast result at train set</span>
<span class="sd">        test_df_y_hat (DataFrame) : forecast result at test set</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">torch</span>
    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>

    <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
        <span class="n">X_train_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_df_X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
        <span class="n">X_test_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">test_df_X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

        <span class="n">y_train_hat</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_train_tensor</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
        <span class="n">y_test_hat</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_test_tensor</span><span class="p">)</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>

    <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
    <span class="n">train_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_train_hat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">train_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">])</span>
    <span class="n">test_df_y_hat</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">y_test_hat</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">test_df_X</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y_hat&#39;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">train_df_y_hat</span><span class="p">,</span> <span class="n">test_df_y_hat</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h2 id="docs.notebooks.model.m18_nbeats.train_model_m18_nbeats" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">train_model_m18_nbeats</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">)</span></code>

<a href="#docs.notebooks.model.m18_nbeats.train_model_m18_nbeats" class="headerlink" title="Permanent link">&para;</a></h2>


    <div class="doc doc-contents ">

        <p>Train and test an NBeats model for point forecasting.
Uses NBeats architecture for predicting time series with lag+exogenous features.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hyperparameter (dict) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>model hyperparameters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_X (DataFrame) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>predictors for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>train_df_y (DataFrame) </code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>target for training</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>model</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>trained PyTorch NBeats model</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>docs\notebooks\model\m18_nbeats.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">train_model_m18_nbeats</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">,</span> <span class="n">train_df_X</span><span class="p">,</span> <span class="n">train_df_y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Train and test an NBeats model for point forecasting.</span>
<span class="sd">    Uses NBeats architecture for predicting time series with lag+exogenous features.</span>

<span class="sd">    Args:</span>
<span class="sd">        hyperparameter (dict) : model hyperparameters</span>
<span class="sd">        train_df_X (DataFrame) : predictors for training</span>
<span class="sd">        train_df_y (DataFrame) : target for training</span>

<span class="sd">    Returns:</span>
<span class="sd">        model : trained PyTorch NBeats model</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># ---- Unpack hyperparameters ----</span>
    <span class="n">input_size</span> <span class="o">=</span> <span class="n">train_df_X</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">output_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;output_size&#39;</span><span class="p">])</span>
    <span class="n">hidden_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;hidden_size&#39;</span><span class="p">])</span>
    <span class="n">num_blocks</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;num_blocks&#39;</span><span class="p">])</span>
    <span class="n">num_layers</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;num_layers&#39;</span><span class="p">])</span>
    <span class="n">lr</span> <span class="o">=</span> <span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;lr&#39;</span><span class="p">]</span>
    <span class="n">epochs</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;epochs&#39;</span><span class="p">])</span>
    <span class="n">seed</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">hyperparameter</span><span class="p">[</span><span class="s1">&#39;seed&#39;</span><span class="p">])</span>

    <span class="c1"># ---- Set seeds for reproducibility ----</span>
    <span class="kn">import</span> <span class="nn">torch</span><span class="o">,</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span><span class="o">,</span> <span class="nn">random</span>
    <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">cuda</span><span class="o">.</span><span class="n">manual_seed_all</span><span class="p">(</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">deterministic</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">torch</span><span class="o">.</span><span class="n">backends</span><span class="o">.</span><span class="n">cudnn</span><span class="o">.</span><span class="n">benchmark</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="c1"># ---- Define NBeats model inside the function ----</span>
    <span class="kn">import</span> <span class="nn">torch.nn</span> <span class="k">as</span> <span class="nn">nn</span>
    <span class="k">class</span> <span class="nc">NBeatsModel</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Module</span><span class="p">):</span>
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">input_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_blocks</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">):</span>
            <span class="nb">super</span><span class="p">(</span><span class="n">NBeatsModel</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
            <span class="n">blocks</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_blocks</span><span class="p">):</span>
                <span class="n">block</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_layers</span><span class="p">):</span>
                    <span class="n">block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">input_size</span> <span class="k">if</span> <span class="n">l</span><span class="o">==</span><span class="mi">0</span> <span class="k">else</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">))</span>
                    <span class="n">block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">ReLU</span><span class="p">())</span>
                <span class="n">block</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="n">hidden_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">))</span>
                <span class="n">blocks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">nn</span><span class="o">.</span><span class="n">Sequential</span><span class="p">(</span><span class="o">*</span><span class="n">block</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">ModuleList</span><span class="p">(</span><span class="n">blocks</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">):</span>
            <span class="n">out</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">block</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">blocks</span><span class="p">:</span>
                <span class="n">out</span> <span class="o">+=</span> <span class="n">block</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">NBeatsModel</span><span class="p">(</span><span class="n">input_size</span><span class="p">,</span> <span class="n">output_size</span><span class="p">,</span> <span class="n">hidden_size</span><span class="p">,</span> <span class="n">num_blocks</span><span class="p">,</span> <span class="n">num_layers</span><span class="p">)</span>

    <span class="c1"># ---- Training setup ----</span>
    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="n">lr</span><span class="p">)</span>
    <span class="n">criterion</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
    <span class="n">X_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_df_X</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
    <span class="n">y_tensor</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">(</span><span class="n">train_df_y</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>

    <span class="c1"># ---- Training loop ----</span>
    <span class="n">model</span><span class="o">.</span><span class="n">train</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">epoch</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epochs</span><span class="p">):</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">zero_grad</span><span class="p">()</span>
        <span class="n">output</span> <span class="o">=</span> <span class="n">model</span><span class="p">(</span><span class="n">X_tensor</span><span class="p">)</span>
        <span class="n">loss</span> <span class="o">=</span> <span class="n">criterion</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">y_tensor</span><span class="p">)</span>
        <span class="n">loss</span><span class="o">.</span><span class="n">backward</span><span class="p">()</span>
        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">model</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.result_aggregation"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.run_experiment"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.run_experiment_batch"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">












  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<a id="docs.notebooks.model.run_tests"></a>
    <div class="doc doc-contents first">










  <div class="doc doc-children">












  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
    
  </body>
</html>